<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="1.分析目标要分析的字段：shield。 2.抓包这个字段在很多请求中有出现，比如登录验证码。   （ps：其实一般先抓包，然后确定分析目标，只不过在网上能找到分析shield的博客，不用孤军奋战！第一次分析大厂app，找个有资料分析的，hhhh，当然~虽然有其它人的博客，但我还是先自己分析，有不会的再看博客~） 3.基本分析通过frida-ps获得包名。   从Manifest文件中获取App类">
<meta property="og:type" content="article">
<meta property="og:title" content="xhs分析——shield字段">
<meta property="og:url" content="http://example.com/2025/06/10/xhs%E5%88%86%E6%9E%90%E2%80%94%E2%80%94shield%E5%AD%97%E6%AE%B5/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="1.分析目标要分析的字段：shield。 2.抓包这个字段在很多请求中有出现，比如登录验证码。   （ps：其实一般先抓包，然后确定分析目标，只不过在网上能找到分析shield的博客，不用孤军奋战！第一次分析大厂app，找个有资料分析的，hhhh，当然~虽然有其它人的博客，但我还是先自己分析，有不会的再看博客~） 3.基本分析通过frida-ps获得包名。   从Manifest文件中获取App类">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530103310169.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530093701399.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530093929614.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530103415270.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530103929768.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530105524482.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530110426774.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530121032468.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530123104099.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530123804548.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530124447630.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530130314460.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530134630822.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530135606186.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530141942891.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530142603508.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530142527896.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530143432846.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530144122340.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530145440602.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530152836580.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530154553559.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530155837197.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530160824936.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530165045013.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530165303554.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530183503982.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530183841508.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250531143219800.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250531143445034.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250531152135241.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250531152215305.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250531152310852.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602092607201.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530144122340.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530143432846.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602095412021.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602095651106.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602095718995.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602094439606.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602100137366.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602101257293.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602101313387.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602105910172.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602110612112.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602111607731.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602111830894.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602112110292.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602112306831.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602112515324.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602113059847.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602113325760.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602113535063.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602113701419.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602135837739.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602141349585.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602141224286.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602141607771.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602142002516.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602142530501.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602142720277.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602144138579.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602144524947.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602144729643.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602144914722.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602145728193.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602164905684.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602165136924.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602175649847.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602175726431.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602175843374.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602175950460.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602180840982.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602180806704.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602181715577.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602181311120.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602181727986.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602182110508.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602182317628.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602182607946.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602182602826.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602182843174.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602182910797.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602183041973.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602183118874.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602183451505.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602191745460.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602192421858.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602192939068.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602193106537.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602193747833.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602193837056.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602194159163.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602194250684.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602194501997.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602194609745.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602194728717.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602194931038.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602195806272.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602195956838.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602200318384.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602200341328.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602200309079.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602200445181.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602200937658.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602201000240.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602201559098.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602201700874.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602201749046.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602201831543.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602201932209.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602202115517.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602202240171.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602202326256.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602202508983.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602202616539.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602202657482.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602202919661.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602203351055.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602203429152.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602203508023.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603101528525.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603121620460.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603122310517.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603122457201.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603122547995.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603124025662.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603130831459.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603132235532.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603133116946.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603133810826.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603135404795.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603134655647.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603134245833.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603142532252.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603144957562.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603150611119.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603151336773.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603151739554.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603151957773.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603152310130.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603152839854.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603153216623.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603154925545.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603155121052.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603155314815.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603161446117.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603161608228.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603162158928.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603162635148.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603163817199.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605093906663.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605100625749.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605125053638.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605101334210.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603181820765.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605144331650.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605144421784.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605144526867.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605145136195.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605152800396.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605155300448.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605160706893.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605161157351.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605161634428.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605162735679.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605161855783.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605162022804.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605162517804.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605162832317.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605162931543.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605163247658.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605163551389.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605144331650.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605164202847.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605165305661.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605165352929.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605165650062.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605165701019.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605165738153.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605170228483.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605175855282.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605180034095.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605183215314.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605184132923.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605205752942.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605210301978.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605210419813.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605210639382.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605210713560.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605210800510.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605210955734.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605214533648.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605214730765.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605214912867.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605215043885.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605215318136.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605215941273.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605220036345.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605220348565.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605222117031.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605222306362.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606093410755.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606093422089.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606093939190.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606094216659.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606094418843.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606094442596.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606094555033.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606100952982.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606101533687.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250604131821514.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606110401435.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606111137178.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606111756494.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606115920475.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606120453309.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606121200628.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606121138961.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606130046944.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606121335072.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606132842937.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606122006533.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606130146772.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606130210235.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606121826620.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606121842021.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606130901638.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606130328066.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606131755330.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606132002394.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606132559512.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606134204767.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606134959994.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606135258040.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606135337277.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606111137178.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606143311760.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606144449746.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606144721289.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606144805944.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606145022167.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606151139575.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606154725222.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606154738763.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606155337349.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606155703863.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606163952156.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250604131821514.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606111137178.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606130901638.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606175216983.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606175711711.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606175911851.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606180338505.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606181133194.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606181450989.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606182624432.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606182803621.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606183329672.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607095231225.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607095624055.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607100823567.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607105851010.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607111129485.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607111219863.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607111353373.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607113630363.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607113813785.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607124335780.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607124755707.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608132421218.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607140241493.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608140802816.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608142243297.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608142607568.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608142854656.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608152840554.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608155657798.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608165240684.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608165909885.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608165050501.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608170636507.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608171823863.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608183325917.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608183652512.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608183908545.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608184300820.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608201229798.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608213042711.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608213356686.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608213042711.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608214219574.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608214446344.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608213042711.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608214939057.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608215911675.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609103836334.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609112747484.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609135943423.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609144742615.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609150053963.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609152424760.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609154735081.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609155821938.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609160301578.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609160958764.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609160740608.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609163752074.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609164111974.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609164347432.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609174510357.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609174519494.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609175346841.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250604131821514.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608201229798.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609181802867.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609182441095.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609182616292.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609182703626.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609182802659.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609184353374.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609184832996.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609185526029.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609185748505.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609185904231.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609190228611.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609190344879.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609190715406.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609191030509.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609191128512.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609191218148.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609191250304.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609191321658.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609200150702.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609200122406.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609200009519.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609201052310.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609201701983.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609201718228.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609201736475.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609201816219.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609201833193.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609200009519.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609205604237.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609205746004.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609210746105.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609210816395.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609211022402.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609211109670.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609200009519.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610101307202.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610101528397.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610104537106.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605222117031.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610150634104.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610151800401.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610151117804.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610180411680.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610181026760.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610181924741.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610182010991.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610182136699.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610182337520.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610182455586.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610161717758.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610162437314.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610164121960.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610194708525.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610200719014.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610200923629.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610204851290.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610204754405.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610204723149.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610204634679.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610185453688.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610211445431.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610214036112.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610214119895.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610214218532.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610221100210.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610221500239.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610221602792.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610221712663.png">
<meta property="og:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610221857418.png">
<meta property="article:published_time" content="2025-06-10T14:29:33.000Z">
<meta property="article:modified_time" content="2025-06-10T14:46:06.776Z">
<meta property="article:author" content="X14Nuy">
<meta property="article:tag" content="心累">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530103310169.png">


<link rel="canonical" href="http://example.com/2025/06/10/xhs%E5%88%86%E6%9E%90%E2%80%94%E2%80%94shield%E5%AD%97%E6%AE%B5/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2025/06/10/xhs%E5%88%86%E6%9E%90%E2%80%94%E2%80%94shield%E5%AD%97%E6%AE%B5/","path":"2025/06/10/xhs分析——shield字段/","title":"xhs分析——shield字段"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>xhs分析——shield字段 | Hexo</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>







  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Hexo</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E5%88%86%E6%9E%90%E7%9B%AE%E6%A0%87"><span class="nav-number">1.</span> <span class="nav-text">1.分析目标</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E6%8A%93%E5%8C%85"><span class="nav-number">2.</span> <span class="nav-text">2.抓包</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E5%9F%BA%E6%9C%AC%E5%88%86%E6%9E%90"><span class="nav-number">3.</span> <span class="nav-text">3.基本分析</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E5%8F%8D%E8%B0%83"><span class="nav-number">4.</span> <span class="nav-text">4.反调</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-%E8%BF%BD%E8%B8%AA%E5%AD%97%E6%AE%B5shield"><span class="nav-number">5.</span> <span class="nav-text">5.追踪字段shield</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-%E5%8A%A0%E5%AF%86%E5%88%86%E6%9E%90"><span class="nav-number">6.</span> <span class="nav-text">6.加密分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96JNI%E8%B0%83%E7%94%A8%E9%93%BE"><span class="nav-number">6.1.</span> <span class="nav-text">获取JNI调用链</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%85%A0-%E9%80%9A%E8%BF%87jmethodID%E8%8E%B7%E5%BE%97%E5%87%BD%E6%95%B0%E5%90%8D"><span class="nav-number">6.1.1.</span> <span class="nav-text">Ⅰ.通过jmethodID获得函数名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%85%A1-hook-JNI%E8%B0%83%E7%94%A8"><span class="nav-number">6.1.2.</span> <span class="nav-text">Ⅱ.hook JNI调用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E6%9E%90shield%E5%8A%A0%E5%AF%86%E7%82%B9"><span class="nav-number">6.2.</span> <span class="nav-text">分析shield加密点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Unidbg%E8%A1%A5%E7%8E%AF%E5%A2%83"><span class="nav-number">6.2.1.</span> <span class="nav-text">Unidbg补环境</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E8%8E%B7%E5%BE%97ShieldLogger%E5%AF%B9%E8%B1%A1"><span class="nav-number">6.2.1.1.</span> <span class="nav-text">1.获得ShieldLogger对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%A8%A1%E6%8B%9FnativeInitializeStart%E6%89%A7%E8%A1%8C"><span class="nav-number">6.2.1.2.</span> <span class="nav-text">2.模拟nativeInitializeStart执行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E6%A8%A1%E6%8B%9FdefaultCharset%E6%89%A7%E8%A1%8C"><span class="nav-number">6.2.1.3.</span> <span class="nav-text">3.模拟defaultCharset执行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E8%8E%B7%E5%BE%97sDeviceID"><span class="nav-number">6.2.1.4.</span> <span class="nav-text">4.获得sDeviceID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E8%8E%B7%E5%BE%97sAppId"><span class="nav-number">6.2.1.5.</span> <span class="nav-text">5.获得sAppId</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-%E6%A8%A1%E6%8B%9FnativeInitializeEnd%E6%89%A7%E8%A1%8C"><span class="nav-number">6.2.1.6.</span> <span class="nav-text">6.模拟nativeInitializeEnd执行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-%E6%A8%A1%E6%8B%9FinitializeStart-%E6%89%A7%E8%A1%8C"><span class="nav-number">6.2.1.7.</span> <span class="nav-text">7.模拟initializeStart()执行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-%E8%8E%B7%E5%BE%97SharedPreferences%E5%AF%B9%E8%B1%A1"><span class="nav-number">6.2.1.8.</span> <span class="nav-text">8.获得SharedPreferences对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-%E5%AE%9E%E7%8E%B0%E5%87%BD%E6%95%B0SharedPreferences-getString"><span class="nav-number">6.2.1.9.</span> <span class="nav-text">9.实现函数SharedPreferences-&gt;getString()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-%E6%A8%A1%E6%8B%9FBase64Helper-decode-%E6%89%A7%E8%A1%8C"><span class="nav-number">6.2.1.10.</span> <span class="nav-text">10.模拟Base64Helper-&gt;decode()执行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-%E6%A8%A1%E6%8B%9FinitializedEnd-%E6%89%A7%E8%A1%8C"><span class="nav-number">6.2.1.11.</span> <span class="nav-text">11.模拟initializedEnd()执行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#12-%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%AE%8C%E6%88%90%E4%BA%86%E5%AF%B9initializeNative-%E5%92%8Cinitialize-%E7%9A%84%E8%B0%83%E7%94%A8%EF%BC%8C%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%AF%B9intercepte%E8%BF%9B%E8%A1%8C%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8"><span class="nav-number">6.2.1.12.</span> <span class="nav-text">12.至此，完成了对initializeNative()和initialize()的调用，接下来对intercepte进行主动调用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#13-%E6%9E%84%E9%80%A0%E4%B8%80%E4%B8%AA%E7%A9%BA%E7%9A%84chain%E5%AF%B9%E8%B1%A1"><span class="nav-number">6.2.1.13.</span> <span class="nav-text">13.构造一个空的chain对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#14-%E6%A8%A1%E6%8B%9Fcom-xingin-shield-http-ShieldLogger-buildSourceStart-%E6%89%A7%E8%A1%8C"><span class="nav-number">6.2.1.14.</span> <span class="nav-text">14.模拟com&#x2F;xingin&#x2F;shield&#x2F;http&#x2F;ShieldLogger-&gt;buildSourceStart()执行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#15-%E4%B8%8B%E8%BD%BDokhttp3%E6%A1%86%E6%9E%B6%EF%BC%8C%E6%A8%A1%E6%8B%9Fokhttp3-Interceptor-Chain-request-%E6%89%A7%E8%A1%8C"><span class="nav-number">6.2.1.15.</span> <span class="nav-text">15.下载okhttp3框架，模拟okhttp3&#x2F;Interceptor$Chain-&gt;request()执行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#16-%E6%A8%A1%E6%8B%9Fokhttp3-Interceptor-Chain-request-%E6%89%A7%E8%A1%8C"><span class="nav-number">6.2.1.16.</span> <span class="nav-text">16.模拟okhttp3&#x2F;Interceptor$Chain-&gt;request()执行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#17-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8Cokhttp3-HttpUrl-encodedPath"><span class="nav-number">6.2.1.17.</span> <span class="nav-text">17.模拟执行okhttp3&#x2F;HttpUrl-&gt;encodedPath()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#18-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8Cokhttp3-HttpUrl-encodedPath"><span class="nav-number">6.2.1.18.</span> <span class="nav-text">18.模拟执行okhttp3&#x2F;HttpUrl-&gt;encodedPath()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#19-%E7%A9%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%BC%82%E5%B8%B8"><span class="nav-number">6.2.1.19.</span> <span class="nav-text">19.空字符串异常</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#20-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8Cokhttp3-Request-body"><span class="nav-number">6.2.1.20.</span> <span class="nav-text">20.模拟执行okhttp3&#x2F;Request-&gt;body()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#21-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8Cokhttp3-Request-headers"><span class="nav-number">6.2.1.21.</span> <span class="nav-text">21.模拟执行okhttp3&#x2F;Request-&gt;headers()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#22-%E6%A8%A1%E6%8B%9F%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0okio-Buffer"><span class="nav-number">6.2.1.22.</span> <span class="nav-text">22.模拟构造函数okio&#x2F;Buffer-&gt;&lt;init&gt;()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#23-%E6%A8%A1%E6%8B%9Fokio-Buffer-writeString-Ljava-lang-String-Ljava-nio-charset-Charset-Lokio-Buffer"><span class="nav-number">6.2.1.23.</span> <span class="nav-text">23.模拟okio&#x2F;Buffer-&gt;writeString(Ljava&#x2F;lang&#x2F;String;Ljava&#x2F;nio&#x2F;charset&#x2F;Charset;)Lokio&#x2F;Buffer;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#24-%E6%A8%A1%E6%8B%9Fokhttp3-Headers-size-I"><span class="nav-number">6.2.1.24.</span> <span class="nav-text">24.模拟okhttp3&#x2F;Headers-&gt;size()I</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#25-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8Cokhttp3-Headers-name-I-Ljava-lang-String"><span class="nav-number">6.2.1.25.</span> <span class="nav-text">25.模拟执行okhttp3&#x2F;Headers-&gt;name(I)Ljava&#x2F;lang&#x2F;String;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#26-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8Cokhttp3-Headers-value-I-Ljava-lang-String"><span class="nav-number">6.2.1.26.</span> <span class="nav-text">26.模拟执行okhttp3&#x2F;Headers-&gt;value(I)Ljava&#x2F;lang&#x2F;String;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#27-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8Cokhttp3-RequestBody-writeTo-Lokio-BufferedSink-V"><span class="nav-number">6.2.1.27.</span> <span class="nav-text">27.模拟执行okhttp3&#x2F;RequestBody-&gt;writeTo(Lokio&#x2F;BufferedSink;)V</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#28-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8Ccom-xingin-shield-http-ShieldLogger-buildSourceEnd-V"><span class="nav-number">6.2.1.28.</span> <span class="nav-text">28.模拟执行com&#x2F;xingin&#x2F;shield&#x2F;http&#x2F;ShieldLogger-&gt;buildSourceEnd()V</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#29-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8Ccom-xingin-shield-http-ShieldLogger-calculateStart-V"><span class="nav-number">6.2.1.29.</span> <span class="nav-text">29.模拟执行com&#x2F;xingin&#x2F;shield&#x2F;http&#x2F;ShieldLogger-&gt;calculateStart()V</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#30-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8Cokio-Buffer-clone-Lokio-Buffer"><span class="nav-number">6.2.1.30.</span> <span class="nav-text">30.模拟执行okio&#x2F;Buffer-&gt;clone()Lokio&#x2F;Buffer;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#31-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8Cokio-Buffer-read-B-I"><span class="nav-number">6.2.1.31.</span> <span class="nav-text">31.模拟执行okio&#x2F;Buffer-&gt;read([B)I</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#32-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8Ccom-xingin-shield-http-ShieldLogger-calculateEnd-V"><span class="nav-number">6.2.1.32.</span> <span class="nav-text">32.模拟执行com&#x2F;xingin&#x2F;shield&#x2F;http&#x2F;ShieldLogger-&gt;calculateEnd()V</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#33-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8Cokhttp3-Request-newBuilder-Lokhttp3-Request-Builder"><span class="nav-number">6.2.1.33.</span> <span class="nav-text">33.模拟执行okhttp3&#x2F;Request-&gt;newBuilder()Lokhttp3&#x2F;Request$Builder;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#34-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8Cokhttp3-Request-newBuilder-Lokhttp3-Request-Builder"><span class="nav-number">6.2.1.34.</span> <span class="nav-text">34.模拟执行okhttp3&#x2F;Request-&gt;newBuilder()Lokhttp3&#x2F;Request$Builder;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#35-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8Cokhttp3-Request-Builder-build-Lokhttp3-Request"><span class="nav-number">6.2.1.35.</span> <span class="nav-text">35.模拟执行okhttp3&#x2F;Request$Builder-&gt;build()Lokhttp3&#x2F;Request;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#36-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8Cokhttp3-Interceptor-Chain-proceed-Lokhttp3-Request-Lokhttp3-Response"><span class="nav-number">6.2.1.36.</span> <span class="nav-text">36.模拟执行okhttp3&#x2F;Interceptor$Chain-&gt;proceed(Lokhttp3&#x2F;Request;)Lokhttp3&#x2F;Response;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#37-%E6%A8%A1%E6%8B%9F%E7%8A%B6%E6%80%81%E7%A0%81"><span class="nav-number">6.2.1.37.</span> <span class="nav-text">37.模拟状态码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#38-%E8%8E%B7%E5%BE%97shield"><span class="nav-number">6.2.1.38.</span> <span class="nav-text">38.获得shield</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Unidbg-trace"><span class="nav-number">6.2.2.</span> <span class="nav-text">Unidbg trace</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%BE%97%E6%97%A5%E5%BF%97"><span class="nav-number">6.2.2.1.</span> <span class="nav-text">获得日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9Unidbg%EF%BC%8C%E8%8E%B7%E5%BE%97%E5%B8%A6%E6%9C%89%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BF%A1%E6%81%AF%E7%9A%84%E6%97%A5%E5%BF%97"><span class="nav-number">6.2.2.2.</span> <span class="nav-text">修改Unidbg，获得带有字符串信息的日志</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BB%E6%89%BE%E5%8A%A0%E5%AF%86%E7%82%B9"><span class="nav-number">6.2.3.</span> <span class="nav-text">寻找加密点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E6%9E%90%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95"><span class="nav-number">6.3.</span> <span class="nav-text">分析加密算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0x10%E4%B8%AA%E5%AD%97%E8%8A%82%EF%BC%88I%EF%BC%89"><span class="nav-number">6.3.1.</span> <span class="nav-text">0x10个字节（I）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC0%E3%80%813-4%E3%80%815-8%E3%80%819-12%E5%AD%97%E8%8A%82%E5%88%86%E6%9E%90"><span class="nav-number">6.3.1.1.</span> <span class="nav-text">第0、3-4、5-8、9-12字节分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC13-16%E5%AD%97%E8%8A%82%E5%88%86%E6%9E%90"><span class="nav-number">6.3.1.2.</span> <span class="nav-text">第13-16字节分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC1-2%E5%AD%97%E8%8A%82%E5%88%86%E6%9E%90"><span class="nav-number">6.3.1.3.</span> <span class="nav-text">第1-2字节分析</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x53%E4%B8%AA%E5%AD%97%E8%8A%82"><span class="nav-number">6.3.2.</span> <span class="nav-text">0x53个字节</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x10%E4%B8%AA%E5%AD%97%E8%8A%82%EF%BC%88%E2%85%A1%EF%BC%89"><span class="nav-number">6.3.3.</span> <span class="nav-text">0x10个字节（Ⅱ）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HMAC-MD5"><span class="nav-number">6.3.3.1.</span> <span class="nav-text">HMAC-MD5</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%AD%94%E6%94%B9%E5%B7%A6%E7%A7%BB%E6%93%8D%E4%BD%9C%E6%95%B0"><span class="nav-number">6.3.3.1.1.</span> <span class="nav-text">魔改左移操作数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%AD%94%E6%94%B9T%E5%80%BC"><span class="nav-number">6.3.3.1.2.</span> <span class="nav-text">魔改T值</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%A5%E5%8F%82%E9%A1%BA%E5%BA%8F%E4%BF%AE%E6%94%B9"><span class="nav-number">6.3.3.1.3.</span> <span class="nav-text">入参顺序修改</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%AD%94%E6%94%B9AES%EF%BC%8C%E8%BF%98%E5%8E%9FQ0"><span class="nav-number">6.3.3.2.</span> <span class="nav-text">魔改AES，还原Q0</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%AF%86%E9%92%A5"><span class="nav-number">6.3.3.2.1.</span> <span class="nav-text">初始密钥</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%AF%86%E2%80%94%E2%80%94Td%E8%A1%A8%EF%BC%88%E6%9C%AA%E6%94%B9%E5%8A%A8%EF%BC%89"><span class="nav-number">6.3.3.2.2.</span> <span class="nav-text">解密——Td表（未改动）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AF%86%E9%92%A5%E6%89%A9%E5%B1%95"><span class="nav-number">6.3.3.2.3.</span> <span class="nav-text">密钥扩展</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">7.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">8.</span> <span class="nav-text">参考</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">X14Nuy</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">26</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/06/10/xhs%E5%88%86%E6%9E%90%E2%80%94%E2%80%94shield%E5%AD%97%E6%AE%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="X14Nuy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="xhs分析——shield字段 | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          xhs分析——shield字段
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-06-10 22:29:33 / 修改时间：22:46:06" itemprop="dateCreated datePublished" datetime="2025-06-10T22:29:33+08:00">2025-06-10</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>71k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2:09</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="1-分析目标"><a href="#1-分析目标" class="headerlink" title="1.分析目标"></a>1.分析目标</h1><p>要分析的字段：shield。</p>
<h1 id="2-抓包"><a href="#2-抓包" class="headerlink" title="2.抓包"></a>2.抓包</h1><p>这个字段在很多请求中有出现，比如登录验证码。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530103310169.png" alt="image-20250530103310169" style="zoom:80%;" />

<p>（ps：其实一般先抓包，然后确定分析目标，只不过在网上能找到分析shield的博客，不用孤军奋战！第一次分析大厂app，找个有资料分析的，hhhh，当然~虽然有其它人的博客，但我还是先自己分析，有不会的再看博客~）</p>
<h1 id="3-基本分析"><a href="#3-基本分析" class="headerlink" title="3.基本分析"></a>3.基本分析</h1><p>通过frida-ps获得包名。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530093701399.png" alt="image-20250530093701399" style="zoom:80%;" />

<p>从Manifest文件中获取App类名。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530093929614.png" alt="image-20250530093929614"></p>
<p>看了一下，似乎没有加壳，因为什么内容都看得见，比如IndexActivityV2。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530103415270.png" alt="image-20250530103415270"></p>
<p>先直接在jadx中搜索，观察能否找到协议字段shield。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530103929768.png" alt="image-20250530103929768"></p>
<p>并没有找到，但感觉有一些类名、字段名比较可疑。——先暂时放着，如果其它方法用不了再来查看这些类与字段。</p>
<p>再尝试使用frida去hook hashMap，一般开发的时候，会用hashMap存储通信协议字段。</p>
<p>打印的调用链有点长。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">[shield] shield</span><br><span class="line">[value] XYAAQAAgAAAAEAAABTAAAAUzUWEe0xG1IbD9/c+qCLOlKGmTtFa+lG434Je+FUTaRHxIzkyONuSp3/qeYJz8Mt3Jx+2fc6EAwYGGHebLP31H5m0rFOBPBvvrx/G4l575l4LPk3</span><br><span class="line">java.lang.Throwable</span><br><span class="line">        at java.util.HashMap.put(Native Method)</span><br><span class="line">        at qd9.h1.intercept(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at wd8.a.intercept(SourceFile:5)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at wd8.m.intercept(SourceFile:6)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at wd8.d.intercept(SourceFile:7)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at wd8.h.intercept(SourceFile:4)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at sf3.b.b(SourceFile:1)</span><br><span class="line">        at sf3.b.intercept(SourceFile:25)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at wd8.r.b(SourceFile:1)</span><br><span class="line">        at wd8.r.intercept(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at com.xingin.shield.http.XhsHttpInterceptor.intercept(Native Method)</span><br><span class="line">        at com.xingin.shield.http.XhsHttpInterceptor.intercept(SourceFile:8)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at ae8.b.c(SourceFile:2)</span><br><span class="line">        at ae8.a.intercept(SourceFile:3)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at wd8.l.intercept(SourceFile:13)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at wd8.s.intercept(SourceFile:13)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at wd8.u.intercept(SourceFile:6)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at rd9.c.intercept(SourceFile:15)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at ne7.c.intercept(SourceFile:11)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at wd8.c.intercept(SourceFile:2)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at qe7.b.intercept(SourceFile:3)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at ve9.d.intercept(SourceFile:8)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at yy8.m.intercept(SourceFile:26)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at on1.b.intercept(SourceFile:2)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at on1.a.intercept(SourceFile:2)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at jf9.c.intercept(SourceFile:1)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at qd9.k.intercept(SourceFile:3)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at yd8.a.intercept(SourceFile:1)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at qd9.p1.intercept(SourceFile:1)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at nj8.j.intercept(SourceFile:5)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at nj8.g.intercept(SourceFile:5)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at hw5.b.intercept(SourceFile:2)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at rd9.e.intercept(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at rd9.b.intercept(SourceFile:12)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at rd9.d.intercept(SourceFile:26)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at yy8.b.intercept(SourceFile:2)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at wd8.o.intercept(SourceFile:33)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at ve9.e$a.intercept(SourceFile:4)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at jf9.l.intercept(SourceFile:8)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at wd8.w.intercept(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:10)</span><br><span class="line">        at okhttp3.internal.http.RealInterceptorChain.proceed(SourceFile:1)</span><br><span class="line">        at okhttp3.RealCall.getResponseWithInterceptorChain(SourceFile:13)</span><br><span class="line">        at okhttp3.RealCall.execute(SourceFile:8)</span><br><span class="line">        at retrofit2.OkHttpCall.execute(SourceFile:8)</span><br><span class="line">        at wc8.b.e(SourceFile:14)</span><br><span class="line">        at io.reactivex.Observable.subscribe(SourceFile:14)</span><br><span class="line">        at wc8.a.e(Unknown Source:23)</span><br><span class="line">        at io.reactivex.Observable.subscribe(SourceFile:14)</span><br><span class="line">        at ms9.n0.e(Unknown Source:17)</span><br><span class="line">        at io.reactivex.Observable.subscribe(SourceFile:14)</span><br><span class="line">        at ms9.l3$b.run(Unknown Source:6)</span><br><span class="line">        at kd8.a.run(SourceFile:3)</span><br><span class="line">        at ud7.a.run(SourceFile:2)</span><br><span class="line">        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:462)</span><br><span class="line">        at java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class="line">        at uh8.h.F(Unknown Source:12)</span><br><span class="line">        at uh8.h.run(SourceFile:9)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:920)</span><br></pre></td></tr></table></figure>

<p>除此之外，进程还在执行一段时间后终止了。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530105524482.png" alt="image-20250530105524482"></p>
<p>我决定先解决反调。</p>
<h1 id="4-反调"><a href="#4-反调" class="headerlink" title="4.反调"></a>4.反调</h1><p>先用常规办法，看是否能解决。</p>
<p>先hook库的加载，观察哪个库加载后会导致进程退出。</p>
<p>下面这个结果是通过hook System.loadLibrary的结果。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530110426774.png" alt="image-20250530110426774" style="zoom:80%;" />

<p>感觉不太对，就打印了一条hook记录。</p>
<p>换一个方式hook，这回hook dlopen和android_dlopen_ext。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530121032468.png" alt="image-20250530121032468"></p>
<p>在加载了libredpreload.so、libmsaoaidsec.so后，退出了。还记得bilibili和豆瓣用的也是libmsaoaidsec.so做反调。</p>
<p>当时的解决方式是：hook掉检测线程或者删掉这个库（如果小红薯没额外对这个库做检查的话），考虑到重新签名太麻烦了，还是hook线程吧。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530123104099.png" alt="image-20250530123104099" style="zoom: 80%;" />

<p>将这3个线程的目标函数替换掉，等待了一段时间，发现进程不崩溃了。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530123804548.png" alt="image-20250530123804548" style="zoom:80%;" />

<p>然后整理一个绕过检测的hook脚本模板，方便之后写其它脚本，这里就不展示了。</p>
<h1 id="5-追踪字段shield"><a href="#5-追踪字段shield" class="headerlink" title="5.追踪字段shield"></a>5.追踪字段shield</h1><p>过完反调，回来继续分析shield字段。</p>
<p>避开sdk的函数，先追踪qd9.h1.intercept。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530124447630.png" alt="image-20250530124447630"></p>
<p>在函数intercept中，找到2个调用put的位置。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530130314460.png" alt="image-20250530130314460" style="zoom:80%;" />

<p>这里的intercept代码可以分成2块，上面一块在拦截和修改<strong>请求</strong>（Request），下面一块在拦截和处理<strong>响应</strong>（Response）。</p>
<p>hook一下函数intercept，观察原本的请求体和修改后的请求体。</p>
<p>我的脚本只获得了输入参数，输出结果却打印不出来——说明hook引发了某些问题，导致调用原本的intercept的时候，陷入了死循环，导致方法stack溢出。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530134630822.png" alt="image-20250530134630822"></p>
<p>又或者是下面这样的报错。（搜了一下，大致原因是：有不可序列化的内容在输出结果里）</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530135606186.png" alt="image-20250530135606186"></p>
<p>但不管怎么说，通过输入参数，我们发现shield已经在传入时就加密好了，说明qd9.h1.intercept并不是我们要找的加密点。</p>
<p>观察了一下前面的调用栈，发现存在shield的字段，追踪过去看看。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">at com.xingin.shield.http.XhsHttpInterceptor.intercept(Native Method)</span><br><span class="line">at com.xingin.shield.http.XhsHttpInterceptor.intercept(SourceFile:8)</span><br></pre></td></tr></table></figure>

<p>hook后发现输入参数没有shield。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530141942891.png" alt="image-20250530141942891"></p>
<p>而hook wd8.r.intercept，发现输入参数存在shield参数。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530142603508.png" alt="image-20250530142603508"></p>
<p>说明，大概率是在com.xingin.shield.http.XshHttpInterceptor.intercept添加了字段shield。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530142527896.png" alt="image-20250530142527896" style="zoom:80%;" />

<p>至此，锁定了加密点。</p>
<h1 id="6-加密分析"><a href="#6-加密分析" class="headerlink" title="6.加密分析"></a>6.加密分析</h1><p>猜测应该是根据this.cPtr生成shield，然后往chain上添加。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530143432846.png" alt="image-20250530143432846"></p>
<p>而this.cPtr的来头有点复杂，咱们不管，直接hook JNI函数intercept，查看j10的值。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530144122340.png" alt="image-20250530144122340"></p>
<p>多次打印，发现j10不会轻易发生改变，j10&#x3D;494045072144。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530145440602.png" alt="image-20250530145440602"></p>
<p>hook RegisterNatives，观察动态注册的函数地址，找到intercept在libxyass.so的偏移是0x9e184。</p>
<p>PS：一开始脚本写错逻辑了，我还以为是静态注册的,,ԾㅂԾ,,然后写了一个遍历文件夹下所有so的脚本，获得导出表，然后筛选我们的intercept——就当作在这里提供一个找静态注册JNI函数的思路吧。</p>
<p>PPS：要找动态注册的函数，还有一个思路，根据JNI在Java的方法名，拿到ArtMethod，然后根据ArtMethod获得JNI函数在Native层的地址，然后判断这个地址在哪个模块，而偏移量则是Native层的地址 - 模块基址。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530152836580.png" alt="image-20250530152836580"></p>
<p>用IDA打开后，修改一下参数名与类型。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530154553559.png" alt="image-20250530154553559"></p>
<p>不知道到底在调用哪个函数，大概率是关于JNIEnv的函数。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530155837197.png" alt="image-20250530155837197"></p>
<p>根据计算，off_AD430 + 0x753016A0 &#x3D;&#x3D; 0x6E13C，看样子是封装了CallObjectMethodV。</p>
<p>问题来了，参数传递的时候，chain为什么会是a2？a2应该是jobject类型。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530160824936.png" alt="image-20250530160824936" style="zoom: 67%;" />

<p>而且，qword_B1740等全局变量尚未被初始化，因此，我决定dump一个so文件下来看看。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530165045013.png" alt="image-20250530165045013"></p>
<p>然后使用工具修复dump下来的elf文件。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530165303554.png" alt="image-20250530165303554"></p>
<p>打开IDA，来到0x9e184，可以发现qword_B1740等全局变量已经回填了。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530183503982.png" alt="image-20250530183503982"></p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530183841508.png" alt="image-20250530183841508" style="zoom:80%;" />

<p>然而，这些jmethodID咱肯定是看不懂的。——这里有3个思路。</p>
<ol>
<li><p>将jmethodID转换成对应的函数名。（难点：先获取jmethodID，再考虑如何转换）</p>
</li>
<li><p>hook JNI函数，打印JNI函数调用序列。（难点：如何筛选sub_9E184中执行的JNI函数）</p>
</li>
<li><p>Unidbg的模拟执行可以打印调用的JNI函数序列。（难点：补环境）</p>
</li>
</ol>
<p>网上的博客都是基于Unidbg进行分析，既然别人用Unidbg，那这里我就用frida吧。——自己分析才更具挑战性嘛。</p>
<h2 id="获取JNI调用链"><a href="#获取JNI调用链" class="headerlink" title="获取JNI调用链"></a>获取JNI调用链</h2><h3 id="Ⅰ-通过jmethodID获得函数名"><a href="#Ⅰ-通过jmethodID获得函数名" class="headerlink" title="Ⅰ.通过jmethodID获得函数名"></a>Ⅰ.通过jmethodID获得函数名</h3><p>jmethodID在内存中实际上是指向ArtMethod结构的指针，也就是说，通过jmethodID可以获得ArtMethod在内存的位置。在libart中有一个函数叫PrettyMethod，往这个函数输入ArtMethod对象，可以打印出对应的函数名，而frida中就内置了这个函数的api。</p>
<p>至此，还有一个问题需要解决——PrettyMethod返回函数名存储在c++的std::string对象中，要对这个string进行合理的解析，才能获得最终的函数名。</p>
<p>安卓的arm64下，std::string类型一般占24字节，也就是3* pointerSize。</p>
<p>需要存储小的字符串时，一般会将字符串直接存在std::string的内存空间中，最多可以存24字节；而需要存储大的字符串时，会另外开辟一处堆空间，用来专门存放字符串的内容，而std::string的原24字节，会用来存储这样的结构：</p>
<ul>
<li><p>一个指向堆上字符数据的指针 (<code>char* data</code>)。</p>
</li>
<li><p>字符串的当前长度 (<code>size_t length</code>)。</p>
</li>
<li><p>当前分配的内存容量 (<code>size_t capacity</code>)。</p>
</li>
</ul>
<p>总结一下，我们输入一个jmethodID后，把它作为参数传给PrettyMethod后，需要对返回的string进行解析，获得函数名字符串地址，然后打印。</p>
<p>PS：至于如何区分小字符串存储还是大字符串存储，这里就不说咯。</p>
<p>下图是一个实现效果。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250531143219800.png" alt="image-20250531143219800" style="zoom:80%;" />

<p>在IDA中添加注释。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250531143445034.png" alt="image-20250531143445034"></p>
<h3 id="Ⅱ-hook-JNI调用"><a href="#Ⅱ-hook-JNI调用" class="headerlink" title="Ⅱ.hook JNI调用"></a>Ⅱ.hook JNI调用</h3><p>github上有大佬写过hook jni调用的frida脚本了，其原理是：hook上libart库中的函数——ArtMethod::Invoke。</p>
<p>ArtMethod::Invoke是ART中负责调用方法的核心函数，无论是Java方法还是JNI方法，最终都会通过Invoke执行。通过对这个函数的hook，可以获得整个进程的方法调用日志。</p>
<p>然而日志太杂乱了，需要筛选，我们只针对libxyass.so中的方法调用，通过反射，可以获取某个类的某个方法的jmethodID，然后反射执行；因此，我们只需要打印调用栈，只要在调用栈中，某个调用的地址在libxyass.so的映射范围内，就将这条日志记录下来。</p>
<p>大佬写的源代码没有过滤的代码，无过滤的、大量的console.log会导致进程卡死，无法获得我们想要的内容，于是我做了一些改动。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250531152135241.png" alt="image-20250531152135241"></p>
<p>其中地址0x6e1b4在CallObjectMethodV_函数的映射范围内。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250531152215305.png" alt="image-20250531152215305"></p>
<p>和我们第1个方法的日志结果一模一样。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250531152310852.png" alt="image-20250531152310852"></p>
<h2 id="分析shield加密点"><a href="#分析shield加密点" class="headerlink" title="分析shield加密点"></a>分析shield加密点</h2><p>为了获得加密函数的trace，这里有3种思路：</p>
<ol>
<li>使用IDA的trace功能；</li>
<li>使用frida-stalker的实现trace；</li>
<li>使用unidbg实现trace。</li>
</ol>
<p>我已经尝试过了第1、2种方式，耗时一天，无论怎么修改脚本，脚本始终跑得不稳定，最多一次trace了20w条指令，进程就崩溃了。</p>
<p>在这20w条指令中，没有看到shield字段的影子，那只能使用unidbg了，麻了。</p>
<h3 id="Unidbg补环境"><a href="#Unidbg补环境" class="headerlink" title="Unidbg补环境"></a>Unidbg补环境</h3><p>先照着其它项目的模板，搭建基础环境。</p>
<h4 id="1-获得ShieldLogger对象"><a href="#1-获得ShieldLogger对象" class="headerlink" title="1.获得ShieldLogger对象"></a>1.获得ShieldLogger对象</h4><p>跑起来后，遇到的第一个问题。</p>
<p>Unidbg的JNI实现调用AbstractJni子类中的getStaticObjectField来解析此字段，但Unidbg的原生实现并不能正确解析，需要子类进行覆写，也就是在我们创建的类中进行覆写。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602092607201.png" alt="image-20250602092607201"></p>
<p>找到getStaticOjectField的实现，然后模仿它的写法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> DvmObject&lt;?&gt; getStaticObjectField(BaseVM vm, DvmClass dvmClass, String signature) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (signature)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;com/xingin/shield/http/ContextHolder-&gt;sLogger:Lcom/xingin/shield/http/ShieldLogger;&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> vm.resolveClass(<span class="string">&quot;com/xingin/shield/http/ShieldLogger&quot;</span>).newObject(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.getStaticObjectField(vm, dvmClass, signature);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后JNI_OnLoad顺利执行完了。</p>
<p>还记得这张图，在调用intercepte之前，需要先后执行initializeNative和initialize。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530144122340.png" alt="image-20250530144122340"></p>
<p>通过上述这2个函数，对so中的静态变量和传入的cPtr进行初始化。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250530143432846.png" alt="image-20250530143432846"></p>
<p>因此，先要调用initializeNative和initialize。通过hook，发现initialize的参数始终是main。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602095412021.png" alt="image-20250602095412021" style="zoom:80%;" />

<p>先创建3个变量。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602095651106.png" alt="image-20250602095651106" style="zoom:80%;" />

<p>然后在构造函数中进行初始化。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602095718995.png" alt="image-20250602095718995" style="zoom:80%;" />

<p>然后创建函数initializeNative和initialize。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602094439606.png" alt="image-20250602094439606"></p>
<p>调用这2个函数，接着进行补环境。</p>
<h4 id="2-模拟nativeInitializeStart执行"><a href="#2-模拟nativeInitializeStart执行" class="headerlink" title="2.模拟nativeInitializeStart执行"></a>2.模拟nativeInitializeStart执行</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602100137366.png" alt="image-20250602100137366"></p>
<p>Unidbg 尝试调用 ShieldLogger 类中定义的原生方法 nativeInitializeStart （一个无参数的 void 方法），但该方法未在您的 AbstractJni 子类中实现或正确处理。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602101257293.png" alt="image-20250602101257293"></p>
<p>不做处理，直接返回。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602101313387.png" alt="image-20250602101313387"></p>
<h4 id="3-模拟defaultCharset执行"><a href="#3-模拟defaultCharset执行" class="headerlink" title="3.模拟defaultCharset执行"></a>3.模拟defaultCharset执行</h4><p>AbstractJni的函数callStaticObjectMethodV未能对java.nio.charset.Charset类上的静态方法defaultCharset()正确解析，因此需要补环境，模拟defaultCharset。</p>
<p>在这里，我们直接调用Charset的defaultCharset，然后转换成DvmObject的类型传回去。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602105910172.png" alt="image-20250602105910172"></p>
<h4 id="4-获得sDeviceID"><a href="#4-获得sDeviceID" class="headerlink" title="4.获得sDeviceID"></a>4.获得sDeviceID</h4><p>我们需要获得设备id，然后转换成DvmObject类型传过去。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602110612112.png" alt="image-20250602110612112"></p>
<p>通过全局搜索，查找类com.xingin.shield.http.ContextHolder。</p>
<p>由于sDeviceId是一个静态变量，可以直接通过类名获取。——518dfe96-7f6f-370a-8e80-f94f8838e6de</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602111607731.png" alt="image-20250602111607731"></p>
<p>然后覆盖AbstractJni的getStaticObjectField。</p>
<p>对于常用的java内置的数据结构，unidbg封装了特别的函数，比如StringObject，就不需要dvmClass.newObject来转换。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602111830894.png" alt="image-20250602111830894"></p>
<h4 id="5-获得sAppId"><a href="#5-获得sAppId" class="headerlink" title="5.获得sAppId"></a>5.获得sAppId</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602112110292.png" alt="image-20250602112110292"></p>
<p>与第4个补环境的流程一样。——sAppId &#x3D; -319115519</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602112306831.png" alt="image-20250602112306831"></p>
<p>覆写。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602112515324.png" alt="image-20250602112515324" style="zoom:80%;" />

<h4 id="6-模拟nativeInitializeEnd执行"><a href="#6-模拟nativeInitializeEnd执行" class="headerlink" title="6.模拟nativeInitializeEnd执行"></a>6.模拟nativeInitializeEnd执行</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602113059847.png" alt="image-20250602113059847"></p>
<p>同样不做处理，直接返回。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602113325760.png" alt="image-20250602113325760" style="zoom:80%;" />

<h4 id="7-模拟initializeStart-执行"><a href="#7-模拟initializeStart-执行" class="headerlink" title="7.模拟initializeStart()执行"></a>7.模拟initializeStart()执行</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602113535063.png" alt="image-20250602113535063"></p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602113701419.png" alt="image-20250602113701419"></p>
<h4 id="8-获得SharedPreferences对象"><a href="#8-获得SharedPreferences对象" class="headerlink" title="8.获得SharedPreferences对象"></a>8.获得SharedPreferences对象</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602135837739.png" alt="image-20250602135837739"></p>
<p>根据报错提示，我们要返回构造好一个SharedPreferences对象。</p>
<p><code>SharedPreferences</code> 是 Android 提供的一种轻量级的数据存储机制。它允许应用程序以<strong>键值对 (key-value pairs)</strong> 的形式持久化存储一些简单的数据类型（如布尔值、浮点数、整数、长整数和字符串）。每个 Android 应用都可以有自己的 <code>SharedPreferences</code> 文件。这些文件存储在应用的私有目录（shared_prefs目录）下，默认情况下其他应用无法访问。它是一个<strong>接口 (Interface)</strong>。这意味着它定义了一套操作规范（比如如何读取数据 <code>getString()</code>, <code>getInt()</code>，如何写入数据 <code>edit().putString().commit()</code> 等），但具体的实现则由 Android 系统提供。</p>
<p><code>Context.getSharedPreferences(name, mode)</code> 是获取或创建特定名称的 <code>SharedPreferences</code> 实例的<strong>标准途径</strong>。你调用这个方法，传入你想要操作的配置文件的名字，然后系统会返回一个实现了 <code>SharedPreferences</code> 接口的对象，你可以通过这个对象来读写数据。</p>
<p>补环境的代码如下。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602141349585.png" alt="image-20250602141349585"></p>
<p>注意，这里的newObject(getSharedPreferences_arg0)并不是调用构造函数，含义如下图所示。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602141224286.png" alt="image-20250602141224286" style="zoom: 50%;" />

<h4 id="9-实现函数SharedPreferences-getString"><a href="#9-实现函数SharedPreferences-getString" class="headerlink" title="9.实现函数SharedPreferences-&gt;getString()"></a>9.实现函数SharedPreferences-&gt;getString()</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602141607771.png" alt="image-20250602141607771"></p>
<p>上一步中，获得了SharedPreferences对象，这里需要通过getString获得value。</p>
<p>通过unidbg，可以打印arg0的值，是“s”。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602142002516.png" alt="image-20250602142002516"></p>
<p>因此，我们去看看xhs私有目录下有没有名为s的文件。——这些文件在原apk中没有，属于服务器下发给客户端的。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602142530501.png" alt="image-20250602142530501"></p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602142720277.png" alt="image-20250602142720277"></p>
<p>android&#x2F;content&#x2F;SharedPreferences-&gt;getString(Ljava&#x2F;lang&#x2F;String;Ljava&#x2F;lang&#x2F;String;)Ljava&#x2F;lang&#x2F;String;的逻辑是这样的：输入2个字符串arg0、v2，输出1个字符串v1；这个函数会获取键arg0对应的值，如果没有，默认返回v2，如果找到了建arg0的值，返回v1。</p>
<p>先通过unidbg获取访问了哪些键。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602144138579.png" alt="image-20250602144138579"></p>
<p>已知main是不存在，s.xml里就放了一个main_hmac，所以可以这么写。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602144524947.png" alt="image-20250602144524947"></p>
<p>为了方便观察，我把返回的结果也打印了。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602144729643.png" alt="image-20250602144729643"></p>
<h4 id="10-模拟Base64Helper-decode-执行"><a href="#10-模拟Base64Helper-decode-执行" class="headerlink" title="10.模拟Base64Helper-&gt;decode()执行"></a>10.模拟Base64Helper-&gt;decode()执行</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602144914722.png" alt="image-20250602144914722"></p>
<p>需要返回解码后的字节数组。</p>
<p>可以调用Base64类进行解码，然后通过unidbg对Byte数组的封装函数，返回回去。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602145728193.png" alt="image-20250602145728193"></p>
<h4 id="11-模拟initializedEnd-执行"><a href="#11-模拟initializedEnd-执行" class="headerlink" title="11.模拟initializedEnd()执行"></a>11.模拟initializedEnd()执行</h4><p>一样对initializedEnd()不做处理。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602164905684.png" alt="image-20250602164905684"></p>
<h4 id="12-至此，完成了对initializeNative-和initialize-的调用，接下来对intercepte进行主动调用"><a href="#12-至此，完成了对initializeNative-和initialize-的调用，接下来对intercepte进行主动调用" class="headerlink" title="12.至此，完成了对initializeNative()和initialize()的调用，接下来对intercepte进行主动调用"></a>12.至此，完成了对initializeNative()和initialize()的调用，接下来对intercepte进行主动调用</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602165136924.png" alt="image-20250602165136924"></p>
<h4 id="13-构造一个空的chain对象"><a href="#13-构造一个空的chain对象" class="headerlink" title="13.构造一个空的chain对象"></a>13.构造一个空的chain对象</h4><p>添加chain。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602175649847.png" alt="image-20250602175649847" style="zoom:80%;" />

<p>调用get_shield()。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602175726431.png" alt="image-20250602175726431"></p>
<h4 id="14-模拟com-xingin-shield-http-ShieldLogger-buildSourceStart-执行"><a href="#14-模拟com-xingin-shield-http-ShieldLogger-buildSourceStart-执行" class="headerlink" title="14.模拟com&#x2F;xingin&#x2F;shield&#x2F;http&#x2F;ShieldLogger-&gt;buildSourceStart()执行"></a>14.模拟com&#x2F;xingin&#x2F;shield&#x2F;http&#x2F;ShieldLogger-&gt;buildSourceStart()执行</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602175843374.png" alt="image-20250602175843374"></p>
<p>补环境。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602175950460.png" alt="image-20250602175950460" style="zoom:80%;" />

<h4 id="15-下载okhttp3框架，模拟okhttp3-Interceptor-Chain-request-执行"><a href="#15-下载okhttp3框架，模拟okhttp3-Interceptor-Chain-request-执行" class="headerlink" title="15.下载okhttp3框架，模拟okhttp3&#x2F;Interceptor$Chain-&gt;request()执行"></a>15.下载okhttp3框架，模拟okhttp3&#x2F;Interceptor$Chain-&gt;request()执行</h4><p>遇到报错。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602180840982.png" alt="image-20250602180840982"></p>
<p>在pom.xml中，添加okhttp3的包，注意缩进。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>okhttp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>保存，并构造request对象。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602180806704.png" alt="image-20250602180806704"></p>
<p>补环境。这里的request是一种标记,可以通过DvmObject.getValue()取出来request的值。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602181715577.png" alt="image-20250602181715577"></p>
<h4 id="16-模拟okhttp3-Interceptor-Chain-request-执行"><a href="#16-模拟okhttp3-Interceptor-Chain-request-执行" class="headerlink" title="16.模拟okhttp3&#x2F;Interceptor$Chain-&gt;request()执行"></a>16.模拟okhttp3&#x2F;Interceptor$Chain-&gt;request()执行</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602181311120.png" alt="image-20250602181311120"></p>
<p>这里的request.url也是一种标记，可以通过DvmObject.getValue()取出来request.url()的值。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602181727986.png" alt="image-20250602181727986"></p>
<h4 id="17-模拟执行okhttp3-HttpUrl-encodedPath"><a href="#17-模拟执行okhttp3-HttpUrl-encodedPath" class="headerlink" title="17.模拟执行okhttp3&#x2F;HttpUrl-&gt;encodedPath()"></a>17.模拟执行okhttp3&#x2F;HttpUrl-&gt;encodedPath()</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602182110508.png" alt="image-20250602182110508"></p>
<p>需要通过getValue取出具体的值，然后调用okhttp3.HttpUrl的encodedQuery()，将返回值转换为DvmObject类型返回去，由于这里是返回字符串，有专门的封装函数StringObject。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602182317628.png" alt="image-20250602182317628" style="zoom:80%;" />

<h4 id="18-模拟执行okhttp3-HttpUrl-encodedPath"><a href="#18-模拟执行okhttp3-HttpUrl-encodedPath" class="headerlink" title="18.模拟执行okhttp3&#x2F;HttpUrl-&gt;encodedPath()"></a>18.模拟执行okhttp3&#x2F;HttpUrl-&gt;encodedPath()</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602182607946.png" alt="image-20250602182607946"></p>
<p>一样的原理。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602182602826.png" alt="image-20250602182602826"></p>
<h4 id="19-空字符串异常"><a href="#19-空字符串异常" class="headerlink" title="19.空字符串异常"></a>19.空字符串异常</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602182843174.png" alt="image-20250602182843174"></p>
<p>根据提示，这里的httpUrlObj_encodedQuery.encodedQuery()返回的是空字符串，即null。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602182910797.png" alt="image-20250602182910797"></p>
<p>方法encodedQuery是用来返回url请求?后面参数用的，而我们的url没有添加?。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602183041973.png" alt="image-20250602183041973"></p>
<h4 id="20-模拟执行okhttp3-Request-body"><a href="#20-模拟执行okhttp3-Request-body" class="headerlink" title="20.模拟执行okhttp3&#x2F;Request-&gt;body()"></a>20.模拟执行okhttp3&#x2F;Request-&gt;body()</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602183118874.png" alt="image-20250602183118874"></p>
<p>复杂对象都用newObject打上标记即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">&quot;okhttp3/Request-&gt;body()Lokhttp3/RequestBody;&quot;</span>:</span><br><span class="line">	<span class="keyword">return</span> vm.resolveClass(<span class="string">&quot;okhttp3/RequestBody&quot;</span>).newObject(request.body());</span><br></pre></td></tr></table></figure>

<h4 id="21-模拟执行okhttp3-Request-headers"><a href="#21-模拟执行okhttp3-Request-headers" class="headerlink" title="21.模拟执行okhttp3&#x2F;Request-&gt;headers()"></a>21.模拟执行okhttp3&#x2F;Request-&gt;headers()</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602183451505.png" alt="image-20250602183451505"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">&quot;okhttp3/Request-&gt;headers()Lokhttp3/Headers;&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> vm.resolveClass(<span class="string">&quot;okhttp3/Headers&quot;</span>).newObject(request.headers());</span><br></pre></td></tr></table></figure>

<h4 id="22-模拟构造函数okio-Buffer"><a href="#22-模拟构造函数okio-Buffer" class="headerlink" title="22.模拟构造函数okio&#x2F;Buffer-&gt;&lt;init&gt;()"></a>22.模拟构造函数okio&#x2F;Buffer-&gt;&lt;init&gt;()</h4><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602191745460.png" alt="image-20250602191745460" style="zoom: 67%;" />

<p>在AbstractJni.newObjectV中，实现了很多构造函数。</p>
<p>现在需要往里面添加okio.Buffer类的构造函数。</p>
<p>观察原有的构造函数实现，其实是往newObject里面存放构造函数后的初始值。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602192421858.png" alt="image-20250602192421858" style="zoom:80%;" />

<p>而okio&#x2F;Buffer-&gt;&lt;init&gt;()是无参构造函数，所以代码应该这么写。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602192939068.png" alt="image-20250602192939068" style="zoom:80%;" />

<h4 id="23-模拟okio-Buffer-writeString-Ljava-lang-String-Ljava-nio-charset-Charset-Lokio-Buffer"><a href="#23-模拟okio-Buffer-writeString-Ljava-lang-String-Ljava-nio-charset-Charset-Lokio-Buffer" class="headerlink" title="23.模拟okio&#x2F;Buffer-&gt;writeString(Ljava&#x2F;lang&#x2F;String;Ljava&#x2F;nio&#x2F;charset&#x2F;Charset;)Lokio&#x2F;Buffer;"></a>23.模拟okio&#x2F;Buffer-&gt;writeString(Ljava&#x2F;lang&#x2F;String;Ljava&#x2F;nio&#x2F;charset&#x2F;Charset;)Lokio&#x2F;Buffer;</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602193106537.png" alt="image-20250602193106537"></p>
<p>函数writeString的返回值是Lokio&#x2F;Buffer，也就是说，我们可以取出Buffer实例，取出2个参数，然后调用writeString，最后将结果转换成DvmObject类型。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602193747833.png" alt="image-20250602193747833" style="zoom:80%;" />

<h4 id="24-模拟okhttp3-Headers-size-I"><a href="#24-模拟okhttp3-Headers-size-I" class="headerlink" title="24.模拟okhttp3&#x2F;Headers-&gt;size()I"></a>24.模拟okhttp3&#x2F;Headers-&gt;size()I</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602193837056.png" alt="image-20250602193837056"></p>
<p>补环境。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602194159163.png" alt="image-20250602194159163"></p>
<h4 id="25-模拟执行okhttp3-Headers-name-I-Ljava-lang-String"><a href="#25-模拟执行okhttp3-Headers-name-I-Ljava-lang-String" class="headerlink" title="25.模拟执行okhttp3&#x2F;Headers-&gt;name(I)Ljava&#x2F;lang&#x2F;String;"></a>25.模拟执行okhttp3&#x2F;Headers-&gt;name(I)Ljava&#x2F;lang&#x2F;String;</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602194250684.png" alt="image-20250602194250684"></p>
<p>已经熟练补环境了。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602194501997.png" alt="image-20250602194501997" style="zoom:80%;" />

<h4 id="26-模拟执行okhttp3-Headers-value-I-Ljava-lang-String"><a href="#26-模拟执行okhttp3-Headers-value-I-Ljava-lang-String" class="headerlink" title="26.模拟执行okhttp3&#x2F;Headers-&gt;value(I)Ljava&#x2F;lang&#x2F;String;"></a>26.模拟执行okhttp3&#x2F;Headers-&gt;value(I)Ljava&#x2F;lang&#x2F;String;</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602194609745.png" alt="image-20250602194609745"></p>
<p>补环境。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602194728717.png" alt="image-20250602194728717" style="zoom:80%;" />

<h4 id="27-模拟执行okhttp3-RequestBody-writeTo-Lokio-BufferedSink-V"><a href="#27-模拟执行okhttp3-RequestBody-writeTo-Lokio-BufferedSink-V" class="headerlink" title="27.模拟执行okhttp3&#x2F;RequestBody-&gt;writeTo(Lokio&#x2F;BufferedSink;)V"></a>27.模拟执行okhttp3&#x2F;RequestBody-&gt;writeTo(Lokio&#x2F;BufferedSink;)V</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602194931038.png" alt="image-20250602194931038"></p>
<p>这里不能像以前一样直接返回return了，得先完成目标操作，再return。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602195806272.png" alt="image-20250602195806272"></p>
<h4 id="28-模拟执行com-xingin-shield-http-ShieldLogger-buildSourceEnd-V"><a href="#28-模拟执行com-xingin-shield-http-ShieldLogger-buildSourceEnd-V" class="headerlink" title="28.模拟执行com&#x2F;xingin&#x2F;shield&#x2F;http&#x2F;ShieldLogger-&gt;buildSourceEnd()V"></a>28.模拟执行com&#x2F;xingin&#x2F;shield&#x2F;http&#x2F;ShieldLogger-&gt;buildSourceEnd()V</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602195956838.png" alt="image-20250602195956838"></p>
<p>补环境。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602200318384.png" alt="image-20250602200318384"></p>
<h4 id="29-模拟执行com-xingin-shield-http-ShieldLogger-calculateStart-V"><a href="#29-模拟执行com-xingin-shield-http-ShieldLogger-calculateStart-V" class="headerlink" title="29.模拟执行com&#x2F;xingin&#x2F;shield&#x2F;http&#x2F;ShieldLogger-&gt;calculateStart()V"></a>29.模拟执行com&#x2F;xingin&#x2F;shield&#x2F;http&#x2F;ShieldLogger-&gt;calculateStart()V</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602200341328.png" alt="image-20250602200341328"></p>
<p>补环境。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602200309079.png" alt="image-20250602200309079"></p>
<h4 id="30-模拟执行okio-Buffer-clone-Lokio-Buffer"><a href="#30-模拟执行okio-Buffer-clone-Lokio-Buffer" class="headerlink" title="30.模拟执行okio&#x2F;Buffer-&gt;clone()Lokio&#x2F;Buffer;"></a>30.模拟执行okio&#x2F;Buffer-&gt;clone()Lokio&#x2F;Buffer;</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602200445181.png" alt="image-20250602200445181"></p>
<p>补环境。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602200937658.png" alt="image-20250602200937658"></p>
<h4 id="31-模拟执行okio-Buffer-read-B-I"><a href="#31-模拟执行okio-Buffer-read-B-I" class="headerlink" title="31.模拟执行okio&#x2F;Buffer-&gt;read([B)I"></a>31.模拟执行okio&#x2F;Buffer-&gt;read([B)I</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602201000240.png" alt="image-20250602201000240"></p>
<p>补环境。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602201559098.png" alt="image-20250602201559098" style="zoom: 67%;" />

<h4 id="32-模拟执行com-xingin-shield-http-ShieldLogger-calculateEnd-V"><a href="#32-模拟执行com-xingin-shield-http-ShieldLogger-calculateEnd-V" class="headerlink" title="32.模拟执行com&#x2F;xingin&#x2F;shield&#x2F;http&#x2F;ShieldLogger-&gt;calculateEnd()V"></a>32.模拟执行com&#x2F;xingin&#x2F;shield&#x2F;http&#x2F;ShieldLogger-&gt;calculateEnd()V</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602201700874.png" alt="image-20250602201700874"></p>
<p>补环境的代码如下。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602201749046.png" alt="image-20250602201749046"></p>
<h4 id="33-模拟执行okhttp3-Request-newBuilder-Lokhttp3-Request-Builder"><a href="#33-模拟执行okhttp3-Request-newBuilder-Lokhttp3-Request-Builder" class="headerlink" title="33.模拟执行okhttp3&#x2F;Request-&gt;newBuilder()Lokhttp3&#x2F;Request$Builder;"></a>33.模拟执行okhttp3&#x2F;Request-&gt;newBuilder()Lokhttp3&#x2F;Request$Builder;</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602201831543.png" alt="image-20250602201831543"></p>
<p>补环境的代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">&quot;okhttp3/Request$Builder-&gt;header(Ljava/lang/String;Ljava/lang/String;)Lokhttp3/Request$Builder;&quot;</span>:</span><br><span class="line">    Request.<span class="type">Builder</span> <span class="variable">builderObj_header</span> <span class="operator">=</span> (Request.Builder) dvmObject.getValue();</span><br><span class="line">    <span class="type">String</span> <span class="variable">header_arg0</span> <span class="operator">=</span> vaList.getObjectArg(<span class="number">0</span>).getValue().toString();</span><br><span class="line">    <span class="type">String</span> <span class="variable">header_arg1</span> <span class="operator">=</span> (String)vaList.getObjectArg(<span class="number">1</span>).getValue();</span><br><span class="line">    builderObj_header.header(header_arg0,header_arg1);</span><br><span class="line">    <span class="keyword">return</span> dvmObject;</span><br></pre></td></tr></table></figure>

<h4 id="34-模拟执行okhttp3-Request-newBuilder-Lokhttp3-Request-Builder"><a href="#34-模拟执行okhttp3-Request-newBuilder-Lokhttp3-Request-Builder" class="headerlink" title="34.模拟执行okhttp3&#x2F;Request-&gt;newBuilder()Lokhttp3&#x2F;Request$Builder;"></a>34.模拟执行okhttp3&#x2F;Request-&gt;newBuilder()Lokhttp3&#x2F;Request$Builder;</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602201932209.png" alt="image-20250602201932209"></p>
<p>补环境的代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">&quot;okhttp3/Request-&gt;newBuilder()Lokhttp3/Request$Builder;&quot;</span>:</span><br><span class="line">    <span class="type">Request</span> <span class="variable">requestObj_newBuilder</span> <span class="operator">=</span> (Request) dvmObject.getValue();</span><br><span class="line">    <span class="keyword">return</span> vm.resolveClass(<span class="string">&quot;okhttp3/Request$Builder&quot;</span>).newObject(requestObj_newBuilder.newBuilder());</span><br></pre></td></tr></table></figure>

<h4 id="35-模拟执行okhttp3-Request-Builder-build-Lokhttp3-Request"><a href="#35-模拟执行okhttp3-Request-Builder-build-Lokhttp3-Request" class="headerlink" title="35.模拟执行okhttp3&#x2F;Request$Builder-&gt;build()Lokhttp3&#x2F;Request;"></a>35.模拟执行okhttp3&#x2F;Request$Builder-&gt;build()Lokhttp3&#x2F;Request;</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602202115517.png" alt="image-20250602202115517"></p>
<p>补环境的代码如下。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602202240171.png" alt="image-20250602202240171"></p>
<h4 id="36-模拟执行okhttp3-Interceptor-Chain-proceed-Lokhttp3-Request-Lokhttp3-Response"><a href="#36-模拟执行okhttp3-Interceptor-Chain-proceed-Lokhttp3-Request-Lokhttp3-Response" class="headerlink" title="36.模拟执行okhttp3&#x2F;Interceptor$Chain-&gt;proceed(Lokhttp3&#x2F;Request;)Lokhttp3&#x2F;Response;"></a>36.模拟执行okhttp3&#x2F;Interceptor$Chain-&gt;proceed(Lokhttp3&#x2F;Request;)Lokhttp3&#x2F;Response;</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602202326256.png" alt="image-20250602202326256"></p>
<p>这里不需要模拟proceed的执行，因为proceed用于发送请求，说明字段shield已经添加好了，我们不关注发包，只关注shield是如何加密的。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602202508983.png" alt="image-20250602202508983"></p>
<h4 id="37-模拟状态码"><a href="#37-模拟状态码" class="headerlink" title="37.模拟状态码"></a>37.模拟状态码</h4><p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602202616539.png" alt="image-20250602202616539"></p>
<p>直接返回200。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602202657482.png" alt="image-20250602202657482" style="zoom:80%;" />

<p>至此，总算是模拟完成了——37个要补充的地方，快累死了。</p>
<h4 id="38-获得shield"><a href="#38-获得shield" class="headerlink" title="38.获得shield"></a>38.获得shield</h4><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602202919661.png" alt="image-20250602202919661" style="zoom:80%;" />

<p>然后打印的是null。</p>
<p>注意到，之前我们在模拟环境的时候，总会使用newObject创建一个新的Request对象返回去，request的值其实始终没改变，因此，我们需要知道，最后一次返回Request类型的对象是哪个函数。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602203351055.png" alt="image-20250602203351055" style="zoom:80%;" />

<p>来到这个代码的地方，添加一句为request赋值的语句，更新request的值。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602203429152.png" alt="image-20250602203429152"></p>
<p>再次查看shield，这回有结果了。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250602203508023.png" alt="image-20250602203508023"></p>
<p>全部代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xhs;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.AndroidEmulator;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.Module;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidEmulatorBuilder;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidResolver;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.*;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.api.Binder;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.api.Bundle;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.api.ServiceManager;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.api.Signature;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.array.ByteArray;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.wrapper.DvmBoolean;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.wrapper.DvmInteger;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.memory.Memory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> okhttp3.*;</span><br><span class="line"><span class="keyword">import</span> okio.Buffer;</span><br><span class="line"><span class="keyword">import</span> okio.BufferedSink;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.NoSuchPaddingException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.security.cert.CertificateException;</span><br><span class="line"><span class="keyword">import</span> java.security.cert.CertificateFactory;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XHS_shield</span> <span class="keyword">extends</span> <span class="title class_">AbstractJni</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AndroidEmulator emulator; <span class="comment">// 静态属性，以后对象和类都可以直接使用</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Memory memory; <span class="comment">// 内存</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> VM vm; <span class="comment">// 虚拟机</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Module <span class="keyword">module</span>; <span class="comment">// 要加载的模块</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">DvmClass</span> <span class="variable">XhsInterceptor</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DvmObject XhsInterceptorObject;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">long</span> cPtr;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">DvmObject</span> <span class="variable">chain</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">public</span> Request request;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">XHS_shield</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 64位虚拟设备，进程名为XHS</span></span><br><span class="line">        emulator = AndroidEmulatorBuilder.for64Bit().setProcessName(<span class="string">&quot;XHS&quot;</span>).build();</span><br><span class="line">        <span class="comment">// 获得内存对象</span></span><br><span class="line">        memory = emulator.getMemory();</span><br><span class="line">        <span class="comment">// 设置安卓sdk版本</span></span><br><span class="line">        memory.setLibraryResolver(<span class="keyword">new</span> <span class="title class_">AndroidResolver</span>(<span class="number">23</span>));</span><br><span class="line">        <span class="comment">// 创建虚拟机</span></span><br><span class="line">        vm = emulator.createDalvikVM(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/xhs_pack/xhs.apk&quot;</span>));</span><br><span class="line">        <span class="comment">// 开启JNI互动</span></span><br><span class="line">        vm.setJni(<span class="built_in">this</span>); <span class="comment">// 后期补环境会用，把要补的环境写到当前类中，执行这个代码即可，但是必须要继承AbstractJni</span></span><br><span class="line">        <span class="comment">// 加载目标so</span></span><br><span class="line">        <span class="type">DalvikModule</span> <span class="variable">dm</span> <span class="operator">=</span> vm.loadLibrary(<span class="string">&quot;xyass&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// 调用jni_onload</span></span><br><span class="line">        dm.callJNI_OnLoad(emulator);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">module</span> = dm.getModule(); <span class="comment">// 把so加载到内存后，可以获得基地址、偏移量，该变量代指so文件</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解析XhsInterceptor</span></span><br><span class="line">        XhsInterceptor = vm.resolveClass(<span class="string">&quot;com/xingin/shield/http/XhsHttpInterceptor&quot;</span>);</span><br><span class="line">        <span class="comment">// 获得一个空chain</span></span><br><span class="line"><span class="comment">//        chain = vm.resolveClass(&quot;okhttp3/Interceptor$Chain&quot;).newObject(null);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构造url和request</span></span><br><span class="line">        url = <span class="string">&quot;https://edith.xiaohongshu.com/api/sns/v4/user/login/password?&quot;</span>;</span><br><span class="line">        request = <span class="keyword">new</span> <span class="title class_">Request</span>.Builder()</span><br><span class="line">                .url(url)</span><br><span class="line">                .addHeader(<span class="string">&quot;xy-direction&quot;</span>,<span class="string">&quot;88&quot;</span>)</span><br><span class="line">                .addHeader(<span class="string">&quot;X-B3-TraceId&quot;</span>,<span class="string">&quot;4b4bdb48881d080f&quot;</span>)</span><br><span class="line">                .addHeader(<span class="string">&quot;x-xray-traceid&quot;</span>,<span class="string">&quot;cb1441a76a4a081ecd469a26f3706ad0&quot;</span>)</span><br><span class="line">                .addHeader(<span class="string">&quot;xy-scene&quot;</span>,<span class="string">&quot;fs=0&amp;point=1932&quot;</span>)</span><br><span class="line">                .addHeader(<span class="string">&quot;x-legacy-did&quot;</span>,<span class="string">&quot;f10f91f68-7db7-3a36-80c9-703abad8fee2&quot;</span>)</span><br><span class="line">                .addHeader(<span class="string">&quot;x-legacy-fid&quot;</span>,<span class="string">&quot;17442981081013d20c9158a0a9b29abbcbb1ed726f5b&quot;</span>)</span><br><span class="line">                .addHeader(<span class="string">&quot;x-legacy-sid&quot;</span>,<span class="string">&quot;session.1744300626655701629150&quot;</span>)</span><br><span class="line">                .addHeader(<span class="string">&quot;x-mini-gid&quot;</span>,<span class="string">&quot;7c0d68e8647a5438a2394bbad364c2bdf31b98794735944077bbfc55&quot;</span>)</span><br><span class="line">                .addHeader(<span class="string">&quot;x-mini-s1&quot;</span>,<span class="string">&quot;ABsAAAABKjIUDN/qnVyFrjdjCBjTNhmOGE0SjnzqstjuHWyj5wVhUjSgHTzsuqoPKuiiOhD4JesIeK1AX8w=&quot;</span>)</span><br><span class="line">                .addHeader(<span class="string">&quot;x-mini-sig&quot;</span>,<span class="string">&quot;a619346fd57b0f2494eb8e197cf8fe6bb33cd62241a67e03343700de0ab8b8ff&quot;</span>)</span><br><span class="line">                .addHeader(<span class="string">&quot;x-mini-mua&quot;</span>,<span class="string">&quot;eyJhIjoiRUNGQUFGMDEiLCJjIjo0MSwiayI6ImQzNjkxYjYzMGJhODNmODljZTM0M2Q5NDlmODU2NTcyNzY5NTg2YTA5YzhmNTJhMjgzNWNiYjhjZjYxZTAwMTciLCJwIjoiYSIsInMiOiJkZmQ0OTI4ZWZlNTA5NDg1MTg5ZmJjOGEwMGRmMmMwYyIsInQiOnsiYyI6NDgsImQiOjQsImYiOjAsInMiOjQwOTgsInQiOjE3NDY3MTQwLCJ0dCI6WzFdfSwidSI6IjAwMDAwMDAwMmMwOGQwYWI0ZDdlNjExMjM4NmU2YmEyOTljZjAzNzIiLCJ2IjoiMi44LjUifQ.r2k40ztxFkHb9YD9W-r8ktVwWcyCuRLf0MmPFBWxV-9voigXNb_Bkvc3Vf8X3qs2wwcX2CpuPWIpylpfB9dwGR_CB3GAZrG1NpfKMjoDZh3Q6VAtuROrlVc7eAi-SqcGE-Z7GoU5tDth4LC9Fg0lbTIa6w6T6WTD_7QUlGroY8huQKkU26M7Whhv7nIFZQtkleznZtw276pAfbuvqyM9zMJb6TN4vqSrPeRRBBIn-7vgTNYF5pS7sF3yeshHP9BbS5QgFACF2I5iBo-z2dSMJkPeyPltMlabkqqJcf4fAjbqECYOCZusmkHXTfFk7-bwTYTW2TzeFFOBYMXNwBWKeOXe4aRqCcqbkjQQzPnJ3EHL-rzXCnKPv7Uf63MfEVxq9LqG398kwYNbUfkRdiGeM_X3OrwBLQ54cmA9jQa25L5jNzUo_2s1dS4Heg1EsEkLtNhAD9zDYDmjRpY6lbe94i_5oWLux8USIomK6_-TbvoEm1w3A51MwcJMVtiop-klqFRHEkazDUQA-76XS1Ogptxo9JpFSSYQt-S6Wet8nvg344UHUuhmXx7bb-gPYepYR6CQOt6EuCNOmLUIDLo0GgniHf2VJNQieSDxuYUIO3EGOXiwzxxB4Lv0TeSRTdqc8U7bLOb-GPeh49my4YWFHVcWEsqRO55EawZF0MSL4aekkiC5ZMm1SpoaJ60XKKVhNfG7sYf7LmIs6kMd3tNFFjvs3CFNlFgu58falTh13_W-sGsMZS3e-Cvlh6PKHic4l36rF2NH1xa2XmbY_VJzQyPm6tlD57IX89HocmwL1emORGPUx6EkhEkgbU-ZiXKcXmEC4W3njsliIc4HY18MurQmn2szKA4Kyl0Yo05igx5DlpJedTiALaaczSuaPr9Ko5xbcrSeFzFPc682BPkwZ1z8H-Hb5ljHDi2wqdvHepBVf8f96SbPEobd52wRjKh4hgdwxuUrKiM4JD3fxlCheGkLvMByCEXL3pP3oMMk7Bjblf-a_qw8cPdjzj_XOzrlcr-gWq1y79AyoyIF3CEri04uJEvnauaNNqLYOjWUYidJiuHdfpj0hQ3o-tEv19hiA4Qx_Bn_qG8BQEpVgksCTu9iwrIaeCjCZ486-waE09M.&quot;</span>)</span><br><span class="line">                .addHeader(<span class="string">&quot;xy-common-params&quot;</span>,<span class="string">&quot;fid=17442981081013d20c9158a0a9b29abbcbb1ed726f5b&amp;gid=7c0d68e8647a5438a2394bbad364c2bdf31b98794735944077bbfc55&amp;device_model=phone&amp;tz=Asia%2FShanghai&amp;channel=Vivo&amp;versionName=8.77.0&amp;deviceId=10f91f68-7db7-3a36-80c9-703abad8fee2&amp;platform=android&amp;sid=session.1744300626655701629150&amp;identifier_flag=4&amp;project_id=ECFAAF&amp;x_trace_page_current=login_full_screen_pwd_page&amp;lang=zh-Hans&amp;app_id=ECFAAF01&amp;uis=light&amp;teenager=0&amp;active_ctry=CN&amp;cpu_name=Qualcomm+Technologies%2C+Inc+SM8150&amp;dlang=zh&amp;launch_id=1744436392&amp;overseas_channel=0&amp;mlanguage=zh_cn&amp;folder_type=none&amp;auto_trans=0&amp;t=1744436385&amp;build=8770299&amp;holder_ctry=CN&amp;did=2d351bbef1db838c5fcd6b67a4aa1db5&quot;</span>)</span><br><span class="line">                .addHeader(<span class="string">&quot;User-Agent&quot;</span>,<span class="string">&quot;Dalvik/2.1.0 (Linux; U; Android 13; Pixel 4 XL Build/TP1A.221005.002.B2) Resolution/1440*3040 Version/8.77.0 Build/8770299 Device/(Google;Pixel 4 XL) discover/8.77.0 NetType/WiFi&quot;</span>)</span><br><span class="line">                .addHeader(<span class="string">&quot;Referer&quot;</span>,<span class="string">&quot;https://app.xhs.cn/&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> DvmObject&lt;?&gt; getStaticObjectField(BaseVM vm, DvmClass dvmClass, String signature) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (signature)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;com/xingin/shield/http/ContextHolder-&gt;sLogger:Lcom/xingin/shield/http/ShieldLogger;&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> vm.resolveClass(<span class="string">&quot;com/xingin/shield/http/ShieldLogger&quot;</span>).newObject(<span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;com/xingin/shield/http/ContextHolder-&gt;sDeviceId:Ljava/lang/String;&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;518dfe96-7f6f-370a-8e80-f94f8838e6de&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getStaticObjectField(vm, dvmClass, signature);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">callVoidMethodV</span><span class="params">(BaseVM vm, DvmObject&lt;?&gt; dvmObject, String signature, VaList vaList)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;com/xingin/shield/http/ShieldLogger-&gt;nativeInitializeStart()V&quot;</span>.equals(signature))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;nativeInitializeStart() trap!&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;com/xingin/shield/http/ShieldLogger-&gt;nativeInitializeEnd()V&quot;</span>.equals(signature))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;nativeInitializeEnd() trap&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;com/xingin/shield/http/ShieldLogger-&gt;initializeStart()V&quot;</span>.equals(signature))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;initializeStart() trap&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;com/xingin/shield/http/ShieldLogger-&gt;initializedEnd()V&quot;</span>.equals(signature))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;initializedEnd() trap&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;com/xingin/shield/http/ShieldLogger-&gt;buildSourceStart()V&quot;</span>.equals(signature))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;buildSourceStart trap&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;okhttp3/RequestBody-&gt;writeTo(Lokio/BufferedSink;)V&quot;</span>.equals(signature))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;writeTo trap&quot;</span>);</span><br><span class="line">            <span class="type">RequestBody</span> <span class="variable">requestBody</span> <span class="operator">=</span> (RequestBody) dvmObject.getValue();</span><br><span class="line">            <span class="type">BufferedSink</span> <span class="variable">bufferedSink</span> <span class="operator">=</span> (BufferedSink) vaList.getObjectArg(<span class="number">0</span>).getValue();</span><br><span class="line">            <span class="keyword">if</span>(requestBody == <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                requestBody.writeTo(bufferedSink);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;com/xingin/shield/http/ShieldLogger-&gt;buildSourceEnd()V&quot;</span>.equals(signature))&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;com/xingin/shield/http/ShieldLogger-&gt;calculateStart()V&quot;</span>.equals(signature))&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;com/xingin/shield/http/ShieldLogger-&gt;calculateEnd()V&quot;</span>.equals(signature))&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">super</span>.callVoidMethodV(vm, dvmObject, signature, vaList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> DvmObject&lt;?&gt; callStaticObjectMethodV(BaseVM vm, DvmClass dvmClass, String signature, VaList vaList) &#123;</span><br><span class="line">        <span class="keyword">switch</span>(signature)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;java/nio/charset/Charset-&gt;defaultCharset()Ljava/nio/charset/Charset;&quot;</span>: &#123;</span><br><span class="line">                <span class="keyword">return</span> dvmClass.newObject(Charset.defaultCharset());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;com/xingin/shield/http/Base64Helper-&gt;decode(Ljava/lang/String;)[B&quot;</span>:&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">getString_arg0</span> <span class="operator">=</span> vaList.getObjectArg(<span class="number">0</span>).getValue().toString();</span><br><span class="line">                System.out.println(<span class="string">&quot;Base64Helper arg0: &quot;</span> + getString_arg0);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ByteArray</span>(vm, Base64.decodeBase64(getString_arg0));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.callStaticObjectMethodV(vm, dvmClass, signature, vaList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getStaticIntField</span><span class="params">(BaseVM vm, DvmClass dvmClass, String signature)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;com/xingin/shield/http/ContextHolder-&gt;sAppId:I&quot;</span>.equals(signature))&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">319115519</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getStaticIntField(vm, dvmClass, signature);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> DvmObject&lt;?&gt; callObjectMethodV(BaseVM vm, DvmObject&lt;?&gt; dvmObject, String signature, VaList vaList)&#123;</span><br><span class="line">        <span class="keyword">switch</span> (signature)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;android/content/Context-&gt;getSharedPreferences(Ljava/lang/String;I)Landroid/content/SharedPreferences;&quot;</span>:&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">getSharedPreferences_arg0</span> <span class="operator">=</span> vaList.getObjectArg(<span class="number">0</span>).getValue().toString();</span><br><span class="line">                System.out.println(<span class="string">&quot;arg0 = &quot;</span> + getSharedPreferences_arg0);</span><br><span class="line">                <span class="keyword">return</span> vm.resolveClass(<span class="string">&quot;android/content/SharedPreferences&quot;</span>).newObject(getSharedPreferences_arg0);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;android/content/SharedPreferences-&gt;getString(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;&quot;</span>:&#123;</span><br><span class="line">                <span class="keyword">if</span>(dvmObject.getValue().toString().equals(<span class="string">&quot;s&quot;</span>))&#123;  <span class="comment">// 获取getSharedPreferences_arg0</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">getString_arg0</span> <span class="operator">=</span> vaList.getObjectArg(<span class="number">0</span>).getValue().toString(); <span class="comment">// 获取键</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">getString_arg1</span> <span class="operator">=</span> vaList.getObjectArg(<span class="number">1</span>).getValue().toString(); <span class="comment">// 获得默认值</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;key: &quot;</span> + getString_arg0);</span><br><span class="line">                    System.out.println(<span class="string">&quot;default_value: &quot;</span> + getString_arg1);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (getString_arg0.equals(<span class="string">&quot;main_hmac&quot;</span>)) &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;SharedPreferences -&gt; getString(): &quot;</span> + <span class="string">&quot;Msm7d4eAmQVoQie97ci+UCY3fL6YKxBwT2qSuID0IOxYqWkpyRFdN6bM2LvQTlPzdQ5qkkJx/T2QMa8V/z+zkKAqh1mZevC+GYm8UJDPuZKbSI/ROWnKwlTiCvIMHEyY&quot;</span>);</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm,<span class="string">&quot;Msm7d4eAmQVoQie97ci+UCY3fL6YKxBwT2qSuID0IOxYqWkpyRFdN6bM2LvQTlPzdQ5qkkJx/T2QMa8V/z+zkKAqh1mZevC+GYm8UJDPuZKbSI/ROWnKwlTiCvIMHEyY&quot;</span>);</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;SharedPreferences -&gt; getString(): &quot;</span> + getString_arg1);</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, getString_arg1);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;okhttp3/Interceptor$Chain-&gt;request()Lokhttp3/Request;&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> vm.resolveClass(<span class="string">&quot;okhttp3/Request&quot;</span>).newObject(request);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;okhttp3/Request-&gt;url()Lokhttp3/HttpUrl;&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> vm.resolveClass(<span class="string">&quot;okhttp3/HttpUrl&quot;</span>).newObject(request.url());</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;okhttp3/HttpUrl-&gt;encodedQuery()Ljava/lang/String;&quot;</span>:&#123;</span><br><span class="line">                <span class="type">HttpUrl</span> <span class="variable">httpUrlObj_encodedQuery</span> <span class="operator">=</span> (HttpUrl) dvmObject.getValue();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, httpUrlObj_encodedQuery.encodedQuery());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;okhttp3/HttpUrl-&gt;encodedPath()Ljava/lang/String;&quot;</span>:&#123;</span><br><span class="line">                <span class="type">HttpUrl</span> <span class="variable">httpUrl</span> <span class="operator">=</span> (HttpUrl) dvmObject.getValue();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, httpUrl.encodedPath());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;okhttp3/Request-&gt;body()Lokhttp3/RequestBody;&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> vm.resolveClass(<span class="string">&quot;okhttp3/RequestBody&quot;</span>).newObject(request.body());</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;okhttp3/Request-&gt;headers()Lokhttp3/Headers;&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> vm.resolveClass(<span class="string">&quot;okhttp3/Headers&quot;</span>).newObject(request.headers());</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;okio/Buffer-&gt;writeString(Ljava/lang/String;Ljava/nio/charset/Charset;)Lokio/Buffer;&quot;</span>:&#123;</span><br><span class="line">                <span class="type">Buffer</span> <span class="variable">buffer</span> <span class="operator">=</span> (Buffer) dvmObject.getValue(); <span class="comment">// 取出实例</span></span><br><span class="line">                <span class="comment">// 取出参数</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">arg0</span> <span class="operator">=</span> vaList.getObjectArg(<span class="number">0</span>).getValue().toString();</span><br><span class="line">                <span class="type">Charset</span> <span class="variable">arg1</span> <span class="operator">=</span> (Charset) vaList.getObjectArg(<span class="number">1</span>).getValue();</span><br><span class="line">                <span class="comment">// 调用writeString</span></span><br><span class="line">                <span class="keyword">return</span> vm.resolveClass(<span class="string">&quot;okio/Buffer&quot;</span>).newObject(buffer.writeString(arg0, arg1));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;okhttp3/Headers-&gt;name(I)Ljava/lang/String;&quot;</span>:&#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">arg0</span> <span class="operator">=</span> vaList.getIntArg(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, ((Headers)dvmObject.getValue()).name(arg0));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;okhttp3/Headers-&gt;value(I)Ljava/lang/String;&quot;</span>:&#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">arg0</span> <span class="operator">=</span> vaList.getIntArg(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, ((Headers)dvmObject.getValue()).value(arg0));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;okio/Buffer-&gt;clone()Lokio/Buffer;&quot;</span>:&#123;</span><br><span class="line">                <span class="keyword">return</span> vm.resolveClass(<span class="string">&quot;okio/Buffer&quot;</span>).newObject(((Buffer)dvmObject.getValue()).clone());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;okhttp3/Request$Builder-&gt;header(Ljava/lang/String;Ljava/lang/String;)Lokhttp3/Request$Builder;&quot;</span>:&#123;</span><br><span class="line">                Request.<span class="type">Builder</span> <span class="variable">builderObj_header</span> <span class="operator">=</span> (Request.Builder) dvmObject.getValue();</span><br><span class="line">                <span class="type">String</span> <span class="variable">header_arg0</span> <span class="operator">=</span> vaList.getObjectArg(<span class="number">0</span>).getValue().toString();</span><br><span class="line">                <span class="type">String</span> <span class="variable">header_arg1</span> <span class="operator">=</span> (String)vaList.getObjectArg(<span class="number">1</span>).getValue();</span><br><span class="line">                builderObj_header.header(header_arg0,header_arg1);</span><br><span class="line">                <span class="keyword">return</span> dvmObject;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;okhttp3/Request-&gt;newBuilder()Lokhttp3/Request$Builder;&quot;</span>:&#123;</span><br><span class="line">                <span class="type">Request</span> <span class="variable">requestObj_newBuilder</span> <span class="operator">=</span> (Request) dvmObject.getValue();</span><br><span class="line">                <span class="keyword">return</span> vm.resolveClass(<span class="string">&quot;okhttp3/Request$Builder&quot;</span>).newObject(requestObj_newBuilder.newBuilder());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;okhttp3/Request$Builder-&gt;build()Lokhttp3/Request;&quot;</span>:&#123;</span><br><span class="line">                Request.Builder builderObj_build= (Request.Builder) dvmObject.getValue();</span><br><span class="line">                <span class="type">Request</span> <span class="variable">requestObj_build</span> <span class="operator">=</span> builderObj_build.build();</span><br><span class="line">                request = requestObj_build;</span><br><span class="line">                <span class="keyword">return</span> vm.resolveClass(<span class="string">&quot;okhttp3/Request&quot;</span>).newObject(requestObj_build);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;okhttp3/Interceptor$Chain-&gt;proceed(Lokhttp3/Request;)Lokhttp3/Response;&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> vm.resolveClass(<span class="string">&quot;okhttp3/Response&quot;</span>).newObject(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.callObjectMethodV(vm, dvmObject, signature, vaList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> DvmObject&lt;?&gt; newObjectV(BaseVM vm, DvmClass dvmClass, String signature, VaList vaList) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (signature)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;okio/Buffer-&gt;&lt;init&gt;()V&quot;</span>:&#123;</span><br><span class="line">                <span class="keyword">return</span> dvmClass.newObject(<span class="keyword">new</span> <span class="title class_">Buffer</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.newObjectV(vm, dvmClass, signature, vaList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">callIntMethodV</span><span class="params">(BaseVM vm, DvmObject&lt;?&gt; dvmObject, String signature, VaList vaList)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (signature)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;okhttp3/Headers-&gt;size()I&quot;</span>:&#123;</span><br><span class="line">                <span class="keyword">return</span> ((Headers) dvmObject.getValue()).size();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;okio/Buffer-&gt;read([B)I&quot;</span>:&#123;</span><br><span class="line">                <span class="type">Buffer</span> <span class="variable">buffer</span> <span class="operator">=</span> (Buffer) dvmObject.getValue();</span><br><span class="line">                <span class="type">byte</span>[] bytes = (<span class="type">byte</span>[]) vaList.getObjectArg(<span class="number">0</span>).getValue();</span><br><span class="line">                <span class="keyword">return</span> buffer.read(bytes);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;okhttp3/Response-&gt;code()I&quot;</span>:&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">200</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.callIntMethodV(vm, dvmObject, signature, vaList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用initialNative</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initializeNative</span><span class="params">()</span>&#123;</span><br><span class="line">        XhsInterceptor.callStaticJniMethod(emulator, <span class="string">&quot;initializeNative()V&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用initialize</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">()</span>&#123;</span><br><span class="line">        XhsInterceptorObject = XhsInterceptor.newObject(<span class="literal">null</span>);</span><br><span class="line">        cPtr = XhsInterceptorObject.callJniMethodLong(emulator, <span class="string">&quot;initialize(Ljava/lang/String;)J&quot;</span>, <span class="string">&quot;main&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;cPtr = &quot;</span> + cPtr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用intercept</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">get_shield</span><span class="params">()</span>&#123;</span><br><span class="line">        chain = vm.resolveClass(<span class="string">&quot;okhttp3/Interceptor$Chain&quot;</span>).newObject(<span class="literal">null</span>);</span><br><span class="line">        DvmObject&lt;?&gt; response = XhsInterceptorObject.callJniMethodObject(emulator, <span class="string">&quot;intercept(Lokhttp3/Interceptor$Chain;J)Lokhttp3/Response;&quot;</span>, chain, cPtr);</span><br><span class="line">        System.out.println(<span class="string">&quot;response = &quot;</span> + response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">XHS_shield</span> <span class="variable">shield</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XHS_shield</span>();</span><br><span class="line">        shield.initializeNative();</span><br><span class="line">        shield.initialize();</span><br><span class="line">        shield.get_shield();</span><br><span class="line">        System.out.println(<span class="string">&quot;shield = &quot;</span> + shield.request.headers().get(<span class="string">&quot;shield&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>补环境补了好久，幸好有大佬们的博客，在补环境的过程中，我也逐渐学会了各式各样的unidbg补环境的方法，今天先歇一歇，明天开始trace指令流，分析加密点。——2025.6.2，晚上20:36。</p>
<h3 id="Unidbg-trace"><a href="#Unidbg-trace" class="headerlink" title="Unidbg trace"></a>Unidbg trace</h3><h4 id="获得日志"><a href="#获得日志" class="headerlink" title="获得日志"></a>获得日志</h4><p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">traceCode</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">traceFile</span> <span class="operator">=</span> <span class="string">&quot;unidbg-android/src/test/java/com/xhs/traceCode.log&quot;</span>; <span class="comment">// 输出的路径</span></span><br><span class="line">    <span class="type">PrintStream</span> <span class="variable">traceStream</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">// 打印流</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        traceStream = <span class="keyword">new</span> <span class="title class_">PrintStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(traceFile), <span class="literal">true</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// traceCode 对代码进行监控</span></span><br><span class="line">    emulator.traceCode(<span class="keyword">module</span>.base, <span class="keyword">module</span>.base + <span class="keyword">module</span>.size).setRedirect(traceStream);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后从JNI_OnLoad开始trace的话，日志存了120w条指令；而从sub_9E184开始trace，只有1700多行，我们主要关注的是sub_9E184的逻辑。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603101528525.png" alt="image-20250603101528525"></p>
<p>注意到，这里把寄存器变化的值打印出来了，假如某寄存器存放着字符串的地址，这里也只是打印地址，而不会打印字符串，这样的日志不便于观察。</p>
<p>因此，我们需要修改traceCode的逻辑。</p>
<h4 id="修改Unidbg，获得带有字符串信息的日志"><a href="#修改Unidbg，获得带有字符串信息的日志" class="headerlink" title="修改Unidbg，获得带有字符串信息的日志"></a>修改Unidbg，获得带有字符串信息的日志</h4><p>注意到，日志会出现符号“&#x3D;&gt;”，于是在整个项目中搜索这个符号。然后发现，文件RegAccessPrinter.java就是我要们要修改的文件。</p>
<p>我在这里设定，每次读取寄存器的内容，当初字符串地址进行访问，如果读取后发现了连续3个可视字符，就当成字符串进行处理，打印整个字符串。</p>
<p>在Unidbg中，读取指定内存区域的字节又该怎么做呢？——我记得Unidbg动调可以访问内存地址，指令是“m”，于是在整个项目搜索“m”，然后发现是用Pointer类型进行访问，于是代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Method to check if the register value points to a readable string and print it</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkAndPrintString</span><span class="params">(<span class="type">long</span> address, StringBuilder builder)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取指向指定地址的 Pointer 对象</span></span><br><span class="line">            <span class="type">Pointer</span> <span class="variable">pointer</span> <span class="operator">=</span> UnidbgPointer.pointer(emulator, address);</span><br><span class="line">            <span class="keyword">if</span> (pointer == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>; <span class="comment">// 地址无效，直接返回</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 从地址读取 256 字节的数据</span></span><br><span class="line">            <span class="type">byte</span>[] bytes = pointer.getByteArray(<span class="number">0</span>, <span class="number">256</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 检查是否为可打印字符串并提取</span></span><br><span class="line">            <span class="keyword">if</span> (isPrintableString(bytes)) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> extractString(bytes);</span><br><span class="line">                builder.append(<span class="string">&quot; (string: \&quot;&quot;</span>).append(str).append(<span class="string">&quot;\&quot;)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// 忽略内存不可读或无效的情况</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check if the first 3 bytes are printable ASCII characters</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isPrintableString</span><span class="params">(<span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (bytes.length &lt; <span class="number">3</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (bytes[i] &lt; <span class="number">32</span> || bytes[i] &gt; <span class="number">126</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Extract the full string until a non-printable character or null terminator</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">extractString</span><span class="params">(<span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">byte</span> b : bytes) &#123;</span><br><span class="line">            <span class="keyword">if</span> (b &gt;= <span class="number">32</span> &amp;&amp; b &lt;= <span class="number">126</span>) &#123;</span><br><span class="line">                sb.append((<span class="type">char</span>) b);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>; <span class="comment">// Stop at first non-printable character</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>将checkAndPrintString移动到函数print内部。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603121620460.png" alt="image-20250603121620460" style="zoom:80%;" />

<p>同时，由于调用UnidbgPointer.Pointer需要Emulator对象，所以还得往类RegAccessPrinter添加成员变量。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603122310517.png" alt="image-20250603122310517"></p>
<p>既然改了构造函数，还需要在调用构造函数的地方，把Emulator对象传进去。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603122457201.png" alt="image-20250603122457201"></p>
<p>重新运行，程序能正常跑了。</p>
<p>日志中出现了我们想看到的字符串。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603122547995.png" alt="image-20250603122547995"></p>
<h3 id="寻找加密点"><a href="#寻找加密点" class="headerlink" title="寻找加密点"></a>寻找加密点</h3><p>通过带有字符串信息的日志可以知道：</p>
<ol>
<li>shield最早出现在哪条指令；</li>
<li>shield的缓冲区地址在哪。</li>
</ol>
<p>于是，有2个思路去寻找加密点：</p>
<ol>
<li>根据shield最早出现的指令，朝着之前的指令进行溯源；</li>
<li>在shield的缓冲区地址设置读写断点。</li>
</ol>
<p>怎么看都是第2种方式更简单。</p>
<p>找到缓冲区地址：0x1240c000。——因为是unidbg模拟的缓冲区，所以缓冲区地址不会变。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603124025662.png" alt="image-20250603124025662"></p>
<p>我们的shield长度是134个字节，内容为：</p>
<p>XYAAQAAgAAAAEAAABTAAAAUzUWEe0xG1IbD9&#x2F;c+qCLOlKGmTtFa+lG434Je+FUTaRHxIzkyONuSp3&#x2F;qeYJz8Mt3Jx+2fc6EAwYGGHebLP31H5m0rHnmtyNNSyC55+4O2fp4TDk</p>
<p>unidbg提供了api，可以对写操作进行监控。——traceWrite。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603130831459.png" alt="image-20250603130831459"></p>
<p>可以发现，偏移0x4b024处在将正确的值写回去了。</p>
<h2 id="分析加密算法"><a href="#分析加密算法" class="headerlink" title="分析加密算法"></a>分析加密算法</h2><p>先在IDA中，来到0x4b024看看。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603132235532.png" alt="image-20250603132235532"></p>
<p>用frida hook一下，查看memcpy复制的内容，发现与最后的shield相差了2个字节，有2个字节（XY）不见了。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603133116946.png" alt="image-20250603133116946" style="zoom:80%;" />

<p>根据之前traceWrite日志，可以发现0x4af74单独对0x1240c000前2个字节进行了修改。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603133810826.png" alt="image-20250603133810826"></p>
<p>根据观察，0x4af70对前2个字节做了赋值，而0x4b020对132个字节进行了赋值。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603135404795.png" alt="image-20250603135404795" style="zoom: 50%;" />

<p>而且，对a1进行交叉引用，发现没有任何修改a1的地方；查看a1被传入的地方，只发现了简单的加解密，也就是说，前2个字节是固定的，根据直接的traceWrtie日志，固定为XY，因此我们分析的重点在v16。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603134655647.png" alt="image-20250603134655647"></p>
<p>而v16似乎涉及加密。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603134245833.png" alt="image-20250603134245833" style="zoom:80%;" />

<p>在Unidbg中，对v16涉及的memcpy下断点，查看源地址是什么。（已知目的地址是0x1240c002）</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603142532252.png" alt="image-20250603142532252"></p>
<p>可以看到，源地址是0x1240c0a0，于是在0x1240c0a0下写断点。</p>
<p>发现，0x1240c0a0在libxyass.so偏移0x82890的地方被写入数据。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603144957562.png" alt="image-20250603144957562"></p>
<p>注意到，shield有点像是base64编码后的结果，而且0x82890的代码又是每轮取出v136的3个字节，然后赋给v138的4个字节，这是base64编码的特征。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603150611119.png" alt="image-20250603150611119" style="zoom:80%;" />

<p>在IDA中，来到汇编层，X10应该是：指向未经过base64编码的数据的地址。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603151336773.png" alt="image-20250603151336773"></p>
<p>在Unidbg中下个断点，然后查看这里的值。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603151739554.png" alt="image-20250603151739554" style="zoom:80%;" />

<p>对这里的内容进行base64编码，跟我们最终的shield后134字节一模一样，坐实了这里是base64编码。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603151957773.png" alt="image-20250603151957773"></p>
<p>注意到，这个数据的地址是0x12411000，对这里下一个写断点。（编码前是99字节）</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603152310130.png" alt="image-20250603152310130" style="zoom:80%;" />

<p>注意到，99个字节的前16个字节的LR指向libxyass.so偏移0x49da0的位置，而后面83个字节来自偏移0x49db4的位置。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603152839854.png" alt="image-20250603152839854" style="zoom:80%;" />

<p>来到IDA中。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603153216623.png" alt="image-20250603153216623" style="zoom:80%;" />

<p>先后查看两个memcpy的源地址（下断点），然后对源地址下写断点。</p>
<p>先看前16字节的memcpy的x1在哪，由于我hook的地址是0x49D9C，有些数据不是我们想要的，我们只需要前16个字节是00 04 00 02…的源地址。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603154925545.png" alt="image-20250603154925545"></p>
<p>第4次进入该函数后，终于找到前16个字节的源地址是0xe4ffefd9。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603155121052.png" alt="image-20250603155121052" style="zoom: 67%;" />

<p>再来找后83个字节的x1在哪。——找到后83个字节在0x123dc060。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603155314815.png" alt="image-20250603155314815" style="zoom:67%;" />

<h3 id="0x10个字节（I）"><a href="#0x10个字节（I）" class="headerlink" title="0x10个字节（I）"></a>0x10个字节（I）</h3><p>通过IDA的伪代码分析，v15是前16个字节，它来自于a1+1或者a1+16的位置。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603161446117.png" alt="image-20250603161446117" style="zoom:80%;" />

<p>hook函数sub_49CE4，查看a1内容。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603161608228.png" alt="image-20250603161608228" style="zoom:80%;" />

<p>确定v15来自a1+1。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603162158928.png" alt="image-20250603162158928" style="zoom:80%;" />

<p>查看交叉引用，从哪一个过来的呢。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603162635148.png" alt="image-20250603162635148" style="zoom:80%;" />

<p>根据trace日志，可以发现是从0x4a2e0跳转过来的。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603163817199.png" alt="image-20250603163817199"></p>
<p>地址0x4a2e0属于函数sub_4a278，hook一下函数的入参，可以发现x0和x1分别指向16字节和83字节，而x2代表x1的长度。</p>
<p>这里继续观察 16个字节，16个字节位于栈0xe4ffefd8上。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605093906663.png" alt="image-20250605093906663" style="zoom:80%;" />

<p>因此对0xe4ffefd8下一个写断点，注意到0x8271C、0x8272C等地址会往里写目标字节。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605100625749.png" alt="image-20250605100625749"></p>
<p>来到0x8271C，位于函数sub_81F00的范围内。</p>
<p>下图，我对17个字节进行了分析（<strong>第0个字节是0x20，0x20并不在目标16字节内，它另有作用</strong>）。</p>
<h4 id="第0、3-4、5-8、9-12字节分析"><a href="#第0、3-4、5-8、9-12字节分析" class="headerlink" title="第0、3-4、5-8、9-12字节分析"></a>第0、3-4、5-8、9-12字节分析</h4><p>v124用来描述v127（53个字节）的长度，所以v124是0x53，经过bswap32后变成0x53 00 00 00。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605125053638.png" alt="image-20250605125053638" style="zoom:80%;" />

<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605101334210.png" alt="image-20250605101334210"></p>
<p>因此，这17个字节的格式是这样的：</p>
<p>20 ?? ?? ?? ?? 00 00 00 01 53 00 00 00 ?? ?? ?? ?? </p>
<p>再来判断第1-4个字节是如何来的。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250603181820765.png" alt="image-20250603181820765"></p>
<p>假设v155是0xAB CD EF GH，左移16位后，0xEF GH 00 00，或上一个2后，0xEF GH 00 02，然后swap32交换次序，0x02 00 GH EF，也就是说，有2个字节是固定的，GH EF相当于原来的v155的低2个字节做了交换。</p>
<p>当前的v157是这样的：</p>
<p>20 ?? ?? 00 02 00 00 00 01 53 00 00 00 ?? ?? ?? ??</p>
<h4 id="第13-16字节分析"><a href="#第13-16字节分析" class="headerlink" title="第13-16字节分析"></a>第13-16字节分析</h4><p>暂时先不分析第1-2字节，这个难度有点高，先来看最后4个字节。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605144331650.png" alt="image-20250605144331650"></p>
<p>对v161进行交叉引用，发现v161 &#x3D; v35。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605144421784.png" alt="image-20250605144421784" style="zoom:80%;" />

<p>阅读下图，v161获得了sub_4A278的返回值，我们上面的图中，也出现了sub_4A278。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605144526867.png" alt="image-20250605144526867" style="zoom:80%;" />

<p>对sub_4A278进行分析，发现它是一个类似memcpy的函数。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605145136195.png" alt="image-20250605145136195"></p>
<p>不同的是，target是std::string类型，而src是char数组。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605152800396.png" alt="image-20250605152800396" style="zoom:80%;" />

<p>string类型是24个字节，之前提到过string类型会对短字符串做sso优化，存储短字符串和长字符串时，string采用的结构不同。</p>
<p>v3 &amp; 1，即target的最低位与1做&amp;，如果（v3&amp;1 !&#x3D; 0）为true，则说明当前当前的string存储着长字符串，采用__long结构；而反之为false，则采用__short结构。</p>
<p>当遇到一个string类型，先判断第0位是否为1，如果是1，则采取__long结构，不用担心第0位的1会影响__cap_的值，__cap_被规定需要2字节对齐，所以第0位单纯是flag；而如果第0位是0，则采取__short结构，该结构会使用高7位表示data的大小，舍弃掉flag的1位，因为data就23个字节，最后一个字节还要存\x00，所以data的实际存储空间大小就22字节，用7位足够表示了。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">+--------+----------------+----------+</span><br><span class="line">|address |    __short     | __long   |</span><br><span class="line">+--------+----------------+----------+</span><br><span class="line">|   0    | __size_ / __lx |          |</span><br><span class="line">+--------+----------------+          |</span><br><span class="line">|   1    |                |          |</span><br><span class="line">|   2    |                |          |</span><br><span class="line">|   3    |                | __cap_   |</span><br><span class="line">|   4    |                |          |</span><br><span class="line">|   5    |                |          |</span><br><span class="line">|   6    |                |          |</span><br><span class="line">|   7    |                |          |</span><br><span class="line">+--------|                |----------+</span><br><span class="line">|   8    |                |          |</span><br><span class="line">|   9    |                |          |</span><br><span class="line">|   10   |                |          |</span><br><span class="line">|   11   |   __data_      | __size_  |</span><br><span class="line">|   12   |                |          |</span><br><span class="line">|   13   |                |          |</span><br><span class="line">|   14   |                |          |</span><br><span class="line">|   15   |                |          |</span><br><span class="line">+--------|                |----------+</span><br><span class="line">|   16   |                |          |</span><br><span class="line">|   17   |                |          |</span><br><span class="line">|   18   |                |          |</span><br><span class="line">|   19   |                | __data_  |</span><br><span class="line">|   20   |                |          |</span><br><span class="line">|   21   |                |          |</span><br><span class="line">|   22   |                |          |</span><br><span class="line">|   23   |                |          |</span><br><span class="line">+--------+----------------+----------+</span><br></pre></td></tr></table></figure>

<p>注意到，在函数sub_81F00中，一共调用了4次sub_4A278，而v34 &#x3D; sub_4A278是第3次调用，也就是说，v34里面累积存放了4个字符串——原本有1个，再通过sub_4A278追加了3个。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605155300448.png" alt="image-20250605155300448"></p>
<p>在Unidbg中模拟执行，对函数sub_4A278进行hook，可以发现：一共就调用了4次sub_81F00，所以基本可以确认，这4次调用都来自于sub_81F00。</p>
<p><strong>第一次调用sub_4A278。</strong></p>
<p>x0指向string类型对象，x1指向char数组，x2是char数组的长度。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605160706893.png" alt="image-20250605160706893"></p>
<p>第1个字节是0x21，它最低位是1，说明是__long类型；</p>
<p>第1个8字节是0x21，由于对齐，算作0x20，也就是说有32个字节的缓冲区；</p>
<p>第2个8字节说明缓冲区已经用了0x18个字节，也就是用掉了24个字节；</p>
<p>第3个8字节是缓冲区（堆）的地址。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605161157351.png" alt="image-20250605161157351" style="zoom:67%;" />

<p>查看堆里面存放的内容，正好24个字节。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605161634428.png" alt="image-20250605161634428" style="zoom:67%;" />

<p>待添加的字符串存在x1指向的地址中。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605162735679.png" alt="image-20250605162735679" style="zoom:80%;" />

<p><strong>第二次调用sub_4A278。</strong></p>
<p>x0指向string类型对象，x1指向char数组，x2是char数组的长度。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605161855783.png" alt="image-20250605161855783"></p>
<p>查看x0的内容。</p>
<p>第1个8字节是0x21，由于对齐，算作0x20，也就是说有32个字节的缓冲区。——因为之前32个字节，原本的字符串长度是24个字节，第一次调用时需要添加了7个字节，而缓冲区剩下的8个字节足够容纳，不需要重新申请空间。</p>
<p>第2个8字节由于添加了7个字节，由0x18 + 0x7变成了0x1F。</p>
<p>第3个8字节由于不用重新申请空间，所以空间地址和第一次调用时的堆地址一样，没变。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605162022804.png" alt="image-20250605162022804">z</p>
<p>查看堆里面存放的内容，可以看到已经添加上8770299了。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605162517804.png" alt="image-20250605162517804"></p>
<p><strong>第三次调用sub_4A278。</strong></p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605162832317.png" alt="image-20250605162832317"></p>
<p>第一个字节是0x51，说明是__long类型。</p>
<p>第1个8字节，0x51视作0x50，说明新申请的缓冲区有80字节的大小。</p>
<p>第2个8字节，0x43表示已经使用了0x43个字节。</p>
<p>第3个8字节，0x12407000是新缓冲区的地址。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605162931543.png" alt="image-20250605162931543" style="zoom:80%;" />

<p>18dfe96-7f6f-370a-8e80-f94f8838e6de已经被复制到缓冲区里了。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605163247658.png" alt="image-20250605163247658" style="zoom:80%;" />

<p>sub_4A278的返回值是string对象的地址，也就是说，v161指向这4个字符串。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605163551389.png" alt="image-20250605163551389"></p>
<p>再也就是说，这里的v123实际上是在获得长度，而4个字符串的长度分别是0x18 + 0x7 + 0x24 + 0x10，和为0x53。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605144331650.png" alt="image-20250605144331650"></p>
<p>所以16字节的第9-12和13-16都是53 00 00 00，都代表着v127的长度。</p>
<p>为什么v156是17字节，而非16个字节，第0个字节为什么是0x20？很明显了，0x20说明是短字符串存储，经过sso优化，直接存储在对象内部，不用开辟堆空间。</p>
<p>砍去一个0不用，剩下的7位表示data部分使用的字节数，0x0010000就是是十进制16，也就是目标16个字节的长度。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605164202847.png" alt="image-20250605164202847"></p>
<p>言归正传，前17个字节的格式是这样的。</p>
<p>20 ?? ?? 00 02 00 00 00 01 53 00 00 00 53 00 00 00</p>
<p>只剩下第1-2字节未解决了。</p>
<h4 id="第1-2字节分析"><a href="#第1-2字节分析" class="headerlink" title="第1-2字节分析"></a>第1-2字节分析</h4><p>第1-2字节与v154有关。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605165305661.png" alt="image-20250605165305661" style="zoom:80%;" />

<p>而v154与a4有关。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605165352929.png" alt="image-20250605165352929" style="zoom:80%;" />

<p>查看函数0x81F00的引用，来到sub_6EFF0。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605165650062.png" alt="image-20250605165650062"></p>
<p>v5与a3相关。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605165701019.png" alt="image-20250605165701019"></p>
<p>函数sub_6EFF0有2个引用。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605165738153.png" alt="image-20250605165738153"></p>
<p>先不着急追踪引用，先在Unidbg中hook函数sub_6EFF0。</p>
<p>发现*a3 &#x3D; 0x4。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605170228483.png" alt="image-20250605170228483"></p>
<p>搜索trace记录，判断函数sub_6EFF0来自于哪个函数调用。</p>
<p>跳转到0x9ef04。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605175855282.png" alt="image-20250605175855282"></p>
<p>v134是传入的a3。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605180034095.png" alt="image-20250605180034095"></p>
<p>在0x9ef04下断点，查看x2，因为v134是一个指针，所以用mx2查看里面的内容。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605183215314.png" alt="image-20250605183215314" style="zoom:80%;" />

<p>v134与v13有关，v13通过多个调用获得初始化。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605184132923.png" alt="image-20250605184132923"></p>
<p>我之前实现过：通过jmethodID获得函数名，因此可以识别这里调用了什么。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605205752942.png" alt="image-20250605205752942"></p>
<p>经过判断，调用了类的初始化函数okio.Buffer.&lt;init&gt;，还调用了writeString。</p>
<p>尝试分析，这里究竟写入了什么。这里我hook上了0x6E13C，0x6E13C封装了CallObjectMethodV，同时根据args[2]（jmethodID）筛选调用的函数，打印写入的字符串。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getStr</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable language_">module</span> = <span class="title class_">Process</span>.<span class="title function_">getModuleByName</span>(<span class="string">&quot;libxyass.so&quot;</span>);</span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(<span class="variable language_">module</span>.<span class="property">base</span>.<span class="title function_">add</span>(<span class="number">0x6E13C</span>), &#123;</span><br><span class="line">        <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_">prettyMethod</span>(args[<span class="number">2</span>], <span class="number">0</span>) == (<span class="string">&quot;okio.Buffer.writeString&quot;</span>))&#123;</span><br><span class="line">                <span class="keyword">var</span> va1 = args[<span class="number">3</span>];</span><br><span class="line">                <span class="keyword">var</span> env = <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>();</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[str]&quot;</span>, <span class="title function_">ptr</span>(env.<span class="title function_">getStringUtfChars</span>(va1)).<span class="title function_">readCString</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写了很多东西。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605210301978.png" alt="image-20250605210301978"></p>
<p>用Unidbg也可以实现类似的效果，写的时候打印一下即可。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605210419813.png" alt="image-20250605210419813"></p>
<p>然后下个断点，判断执行前后能否打印字符串。</p>
<p>成功打印字符串“&#x2F;api&#x2F;sns&#x2F;v4&#x2F;user&#x2F;login&#x2F;password”，但发现了点小问题。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605210639382.png" alt="image-20250605210639382"></p>
<p>观察我补的环境，发现这里传入了一个新的dvmObject，可能是因为这个原因。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605210713560.png" alt="image-20250605210713560" style="zoom:67%;" />

<p>改成这样子。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605210800510.png" alt="image-20250605210800510" style="zoom:67%;" />

<p>然后再跑一次，这回jobject的值一致了。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605210955734.png" alt="image-20250605210955734" style="zoom:80%;" />

<p>最后v134应该指向栈上地址：0xe4fff640，但没找到v134被修改的地方。</p>
<p>只能说，只看伪代码果然不行，接下来看汇编了，前面的内容供读者图一乐，错误经验也是经验，主要是展示我个人的分析流程。</p>
<p>往栈地址0xe4fff640下一个写断点，发现是0x9eddc往0xe4fff640里写了0x4。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605214533648.png" alt="image-20250605214533648"></p>
<p>在0x9eddc下一个断点，判断一下Q3、Q2哪个存放了0x4。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605214730765.png" alt="image-20250605214730765"></p>
<p>q3存放0x4。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605214912867.png" alt="image-20250605214912867"></p>
<p>而Q3 &#x3D; [X24 + 252]，往0x9EDC4下断点，查看X24+252和是多少，然后给X24+252下一个写断点。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605215043885.png" alt="image-20250605215043885"></p>
<p>x24 &#x3D; 0x123df000，因此在0x123df0fc下一个写断点。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605215318136.png" alt="image-20250605215318136"></p>
<p>下了断点后，发现是0x920AC的指令再往0x123df0fc里写0x4。</p>
<p>而w8的值由LDR w8,[x8]得来的。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605215941273.png" alt="image-20250605215941273" style="zoom: 80%;" />

<p>而x8的值是0x123dc060。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605220036345.png" alt="image-20250605220036345"></p>
<p>再在0x123dc060下一个写断点，找是谁往0x123dc060里写入的0x4。</p>
<p>地址0x9aab8的指令往0x123dc060里写0x4。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605220348565.png" alt="image-20250605220348565"></p>
<p>分析一波，如图所示。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605222117031.png" alt="image-20250605222117031"></p>
<p>可以下个断点在0x9AAA4，查看每次取的16字节来自于哪里。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605222306362.png" alt="image-20250605222306362" style="zoom:80%;" />

<p>Q1的16字节来自栈上基址（且x19指向的）0xe4fff200、Q0的16字节来自栈上基址（且x22指向的）0xe4fff148。</p>
<p>Q1和Q0只有低字节不一样，Q1是0x31，Q0是0x35。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606093410755.png" alt="image-20250606093410755" style="zoom:80%;" />

<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606093422089.png" alt="image-20250606093422089" style="zoom:80%;" />

<p>先为0xe4fff200下一个写断点，判断这16个字节（31 01 32…17 66 39）是什么时候写入的。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606093939190.png" alt="image-20250606093939190"></p>
<p>发现是0x92830的指令在往里面写，跳转过去看看。</p>
<p>Q0 &#x3D; [x8 + x10]，在0x92820下一个断点，查看x8与x10的值。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606094216659.png" alt="image-20250606094216659"></p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606094418843.png" alt="image-20250606094418843"></p>
<p>得出0x12019A30。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606094442596.png" alt="image-20250606094442596" style="zoom:80%;" />

<p>Unidbg的映射基地址是0x1200000，所以这里的偏移指向so文件的0x19A30。</p>
<p>发现这里是.rodata节的内容，也就是说，Q1的16字节，来自于文件中硬编码的16字节。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606094555033.png" alt="image-20250606094555033"></p>
<p>再追踪Q0的16字节从何而来，对0xe4fff148下一个写断点。</p>
<p>注意到，似乎对每个字节赋值的地址不同。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606100952982.png" alt="image-20250606100952982"></p>
<p>这里先追踪Q0最低字节，因为Q1和Q0只在这里有所不同。</p>
<p>来到0x9A064。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606101533687.png" alt="image-20250606101533687"></p>
<p>对这一块代码进行还原，发现有点复杂啊。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250604131821514.png" alt="image-20250604131821514"></p>
<p>借鉴了一下其它人的分析，Q0的16个字节来自于变种AES加密，因此这里先放一放，先去分析另外53个字节。</p>
<h3 id="0x53个字节"><a href="#0x53个字节" class="headerlink" title="0x53个字节"></a>0x53个字节</h3><p>前面提到，0x53个字节其实是分为4块，每块的字节数分别是0x18、0x7、0x24、0x10，</p>
<p>通过hook函数sub_4A278便可获得这4块内容。</p>
<p>下图是第3次调用sub_4A278的位置，可以在这边下一个断点，观察4个字符串未加密前是什么。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606110401435.png" alt="image-20250606110401435"></p>
<p>这是加密前的内容，位于0x1240c000。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606111137178.png" alt="image-20250606111137178"></p>
<p>在对第四次调用sub_4A278的位置下断点，这个时候里面的内容虽然也是0x53个字节，但已经加密了。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606111756494.png" alt="image-20250606111756494" style="zoom:80%;" />

<p>加密点应该在第3次调用与第四次调用之间。</p>
<p>在0x123dc060下写断点，指令0x8235C处往里面写了0x35，0x8235C位于函数sub_81F00内。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606115920475.png" alt="image-20250606115920475"></p>
<p>跳转到0x8235C，看不出加密算法。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606120453309.png" alt="image-20250606120453309" style="zoom:67%;" />

<p>慢慢分析。</p>
<p>先对sub_81F00进行hook，打印入参。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606121200628.png" alt="image-20250606121200628" style="zoom:80%;" />

<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606121138961.png" alt="image-20250606121138961"></p>
<p>（x0）a1 &#x3D; 1。（疑似固定值）</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606130046944.png" alt="image-20250606130046944" style="zoom:80%;" />

<p>（x1）a2是个字符数组，代表build，如下。</p>
<p>0xE表示sso存储，占用了7个字节。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606121335072.png" alt="image-20250606121335072" style="zoom:80%;" />

<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606132842937.png" alt="image-20250606132842937" style="zoom:80%;" />

<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606122006533.png" alt="image-20250606122006533"></p>
<p>（x2）a3来自于AppId。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606130146772.png" alt="image-20250606130146772" style="zoom:80%;" />

<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606130210235.png" alt="image-20250606130210235" style="zoom:67%;" />

<p>（x3）a4为0x4；——之前q1、q2异或的0x4。</p>
<p>（x4）a5是个string类型；</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606121826620.png" alt="image-20250606121826620"></p>
<p>存放了device_id。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606121842021.png" alt="image-20250606121842021"></p>
<p>（x5）a6&#x3D;0xe4fff521，似乎存放了16个字节。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606130901638.png" alt="image-20250606130901638" style="zoom:67%;" />

<p>（x6）a7 &#x3D; 0x10，似乎代表a6的大小。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606130328066.png" alt="image-20250606130328066"></p>
<p>（x7）a8&#x3D;0x38663439662d3038，存放了8个字符“80-f94f8”。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606131755330.png" alt="image-20250606131755330"></p>
<p>似乎是device_id的一部分。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606132002394.png" alt="image-20250606132002394" style="zoom:80%;" />

<p>改一下变量名。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606132559512.png" alt="image-20250606132559512" style="zoom:80%;" />

<p>结合入参进行改名。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606134204767.png" alt="image-20250606134204767" style="zoom:80%;" />

<p>插入一个结构体，方便分析。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606134959994.png" alt="image-20250606134959994" style="zoom:80%;" />

<p>接着往下分析。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606135258040.png" alt="image-20250606135258040"></p>
<p>点进xmmword_19AA0，0x21说明了是长字符串存储，缓冲区大小是0x20个字节，已经占用了0x18个字节。（v157的前16个字节来自于xmmword_19AA0，缓冲区的地址并不是通过v157&#x3D;xmmword_19AA0得到的）</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606135337277.png" alt="image-20250606135337277"></p>
<p>v157指向红色框中的这18个字节。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606111137178.png" alt="image-20250606111137178"></p>
<p>接着往下分析。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606143311760.png" alt="image-20250606143311760"></p>
<p>观察变量“ptr_18bytes_AND_build_id_AND_device_id_b”的值，它的值其实在之前就清空了，这里应该是复用了，因为不知道它在加密部分是什么含义，暂时没改变量名。</p>
<p>hook上0x821B0的位置，访问x9所指向的内存地址，查看内容有什么变化。（根据计算，有32次循环，记作0-31）</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606144449746.png" alt="image-20250606144449746"></p>
<p>第0次循环。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606144721289.png" alt="image-20250606144721289"></p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606144805944.png" alt="image-20250606144805944" style="zoom:80%;" />

<p>在执行了几次循环后，如下图所示。</p>
<p>从第8个字节开始，0x0、0x1…依次递增，一次循环可以初始化8个4字节，而执行32次，也就是说，从0一直到(32*8 - 1)，也就是0x0到0xff。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606145022167.png" alt="image-20250606145022167"></p>
<p>而！RC4流密码中，在初始化状态向量时，SBox就是这么得来的，SBox的初始化的伪代码如下。</p>
<p>一般的RC4中，SBox是字节数组，而这里是4字节为单位的数组。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">    S[i] = i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果猜想是对的话，待会应该还有一段用密钥对S盒进行置换的过程，暂时先将“ptr_18bytes_AND_build_id_AND_device_id_b”重命名为“SBox”。</p>
<p>继续往下分析。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606151139575.png" alt="image-20250606151139575"></p>
<p>待会再去hook获得密钥，先来看看这个S盒置换算法。</p>
<p>下面这段代码基本可以说明，就是RC4算法，而且密钥长度为13——0到12。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606154725222.png" alt="image-20250606154725222"></p>
<p>循环64次，说明每次循环交换4次。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606154738763.png" alt="image-20250606154738763" style="zoom:80%;" />

<p>hook一下，得到密钥看看。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606155337349.png" alt="image-20250606155337349"></p>
<p>x8&#x3D;0x1201b48d，说明密钥在文件偏移0x1b48d的位置。</p>
<p>试图用字符串“std::abort();”作掩护，hhhh。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606155703863.png" alt="image-20250606155703863" style="zoom:80%;" />

<p>拿去试一下，发现是个非常标准的rc4加密。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606163952156.png" alt="image-20250606163952156"></p>
<p>至此，0x53个字节分析完了。</p>
<h3 id="0x10个字节（Ⅱ）"><a href="#0x10个字节（Ⅱ）" class="headerlink" title="0x10个字节（Ⅱ）"></a>0x10个字节（Ⅱ）</h3><p>还记得，在**16个字节（Ⅰ）**中，我们分析得出，16个字节的格式如下：</p>
<p>20 ?? ?? 00 02 00 00 00 01 53 00 00 00 53 00 00 00</p>
<p>当时最大的问题是：?? ??的值由Q1与Q0异或得来，Q1是硬编码在文件中的，而Q0的值，当时只追踪了最低字节。</p>
<p>当时为了得出Q0的最低字节从何而来，我逆了一下算法，但涉及到的缓冲区有点多。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250604131821514.png" alt="image-20250604131821514"></p>
<p>所以在这一小节，我们的目标之一是<strong>还原Q0</strong>，还有一个目标是分析<strong>绿色框里的16个字节</strong>从何而来。</p>
<p>（我好像没解释过红色框，红色框的前4个字节是函数sub_81F00传入的a1，是固定值；再4个字节是app_id，0x2是根据传Q1与Q0异或的0x4判断得到的；0x7代表build的大小，0x24代表device_id的大小，0x10代表未知的16个字节）</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606111137178.png" alt="image-20250606111137178"></p>
<h4 id="HMAC-MD5"><a href="#HMAC-MD5" class="headerlink" title="HMAC-MD5"></a>HMAC-MD5</h4><p>这16个字节是函数sub_81F00的入参a6，对应的缓冲区地址是0xe4fff521。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606130901638.png" alt="image-20250606130901638" style="zoom:67%;" />

<p>在0xe4fff521下一个写断点。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606175216983.png" alt="image-20250606175216983"></p>
<p>地址0x6f768处的指令对0xe4fff521进行了写。</p>
<p>0xe4fff521的值由Q0得到，Q0的值由[X29,#-0x18]得到，所以在0x6F758下断点（或者看日志）。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606175711711.png" alt="image-20250606175711711"></p>
<p>x29&#x3D;0xe4fff470，所以X29 - 0x18是0xE4FFF458。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606175911851.png" alt="image-20250606175911851"></p>
<p>在0xE4FFF458下写断点，发现是0x92fd8。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606180338505.png" alt="image-20250606180338505"></p>
<p>地址0x92fd8位于函数sub_92F2C范围内。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606181133194.png" alt="image-20250606181133194" style="zoom:80%;" />

<p>我们需要的16字节存储在a2中，a2由v2赋值。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606181450989.png" alt="image-20250606181450989"></p>
<p>w8是上图的a2，a2的值地址0x92FCC获得，所以在0x92FCC下一个断点，查看X20的值。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606182624432.png" alt="image-20250606182624432"></p>
<p>x20的值是0x123df480。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606182803621.png" alt="image-20250606182803621"></p>
<p>在x20下写断点。</p>
<p>可以看到，偏移0x93f74对0x123df480进行了写操作。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250606183329672.png" alt="image-20250606183329672"></p>
<p>来到0x93f74。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607095231225.png" alt="image-20250607095231225"></p>
<p>对应于汇编的伪代码。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607095624055.png" alt="image-20250607095624055"></p>
<p>现在0x93F74下个断点，发现这个函数执行了很多次，迟迟等不到我们要看的内容，于是统计一下这个函数执行的次数。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607100823567.png" alt="image-20250607100823567"></p>
<p>同时，分析算法，发现一个很有意思的点。</p>
<p>假设HIDWORD(v4) &#x3D; R，那么LODWORD(v4)也等于R，也就是说64位的高32位和低32位是一样的，都为R。</p>
<p>而v4 &gt;&gt; 17可以写成(R &lt;&lt; 32 | R) &gt;&gt; 17，进一步可以写成((R &lt;&lt; 32) &gt;&gt; 17) | R &gt;&gt; 17。</p>
<p>(R &lt;&lt; 32) &gt;&gt; 17的结果是 R 左移（32 - 17 &#x3D; 15）位，并占据了结果的高位部分。</p>
<p>R &gt;&gt; 17的结果是 R 右移17位，占据了结果的低位部分。</p>
<p>v5是一个32位的数据类型，所以当上述的两者通过或组合在一块，就相当于将R循环右移了17位。</p>
<p>而循环右移17位，等同于循环左移15位。</p>
<p>（注意这里的&lt;&lt;都是逻辑左移和逻辑右移，而不是循环左移和循环右移）</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607105851010.png" alt="image-20250607105851010"></p>
<p>md5算法有4轮运算：F、G、H、I，每一轮运算要执行16次（因为有16个子分组），在I运算中，涉及循环左移6、10、15、21位；除此之外，I运算涉及异或、取反、或等操作。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607111129485.png" alt="image-20250607111129485" style="zoom:80%;" />

<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607111219863.png" alt="image-20250607111219863" style="zoom:80%;" />

<p>而在sub_93F14中，发现了循环左移15位，还有循环左移21位，同时发现了一些异或、取反的操作，又考虑到这个函数执行了16次，这大概率是md5算法的II运算。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607111353373.png" alt="image-20250607111353373"></p>
<p>还发现了md5的魔数，按常理来说，II运算是第4轮运算，魔数ABCD早被修改了，但编译器似乎没对寄存器x0进行操作，魔数一直存在x0中。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607113630363.png" alt="image-20250607113630363" style="zoom: 67%;" />

<p>更加坐实了这是一个魔改的md5算法。——为什么说是魔改，之后会说。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607113813785.png" alt="image-20250607113813785" style="zoom:80%;" />

<p>分析trace日志中，0x93F74出现的地方，对应上调用了16次函数sub_93F14。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607124335780.png" alt="image-20250607124335780" style="zoom:80%;" />

<p>在第16次的时候，w28出现了未知16字节中的4个字节。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607124755707.png" alt="image-20250607124755707"></p>
<p>在第16次调用的trace记录，w27是魔数，w28的值来自于[0xe4fff2c0 - 0x34]，即[0xE4FFF28C]。</p>
<p>要同时追踪w27和w28吗？其实不用。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608132421218.png" alt="image-20250608132421218"></p>
<p>下图是第1次调用的trace记录，w27是一个魔数，所以只追踪w28。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250607140241493.png" alt="image-20250607140241493"></p>
<p>第三轮运算最终的a、b、c、d的第四轮运算的初始a、b、c、d。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608140802816.png" alt="image-20250608140802816" style="zoom:67%;" />

<p>在0xe4fff1f0-0x34处下一个写断点，观察里面的值来自于哪，大概率是md5的HH轮运算传过来的。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608142243297.png" alt="image-20250608142243297"></p>
<p>偏移0x94534位于函数sub_944A8内，符合md5的特征，看样子还是II运算。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608142607568.png" alt="image-20250608142607568" style="zoom:80%;" />

<p>结合上图和下图，有点像是MD5的第60、61、62、63、64轮运算。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608142854656.png" alt="image-20250608142854656" style="zoom:80%;" />

<p>结合标准的md5算法，md5的63、64轮明显被魔改了。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608152840554.png" alt="image-20250608152840554"></p>
<p>有一个疑惑，既然这里是md5的第63、64轮加密，为什么函数sub_93F14调用了16次？我原本以为，这里魔改的II运算，结果似乎只涉及63、64轮加密，前面的分析有些误打误撞，不过确认了，使用的加密算法是md5，涉及一些变异。</p>
<p>回到函数sub_92F2C，对函数进行hook，判断v2是从什么变成16个字节。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608155657798.png" alt="image-20250608155657798" style="zoom: 67%;" />

<p>发现要加密的内容是16个字节。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608165240684.png" alt="image-20250608165240684" style="zoom:80%;" />

<p>对函数sub_92F2C进行分析，静态分析下，可能会调用了2次sub_93390，第1次调用是为了处理空间不足的情况，因为md5的每个分组是512位，要留出最后64位记录信息长度，所以实际能用来存储的空间只有56字节。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608165909885.png" alt="image-20250608165909885"></p>
<p>创建结构体，对变量进行修改。</p>
<p>0x80是填充值，数据长度要小于等于55，因为至少有1个字节是填充值。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608165050501.png" alt="image-20250608165050501" style="zoom: 67%;" />

<p>接下来，分析函数sub_93390，它大概率是在进行md5加密，根据统计，一共执行了5次sub_93390。——这也无法解释为什么调用了sub_93F14共计16次，再放一会吧。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608170636507.png" alt="image-20250608170636507"></p>
<p>而我hook函数sub_92F2C，这个函数执行了2次，而且每一次数据的量都没有超过55字节，说明还有其它3处地方调用了sub_93390，进行md5加密。</p>
<p>搜索trace记录，从第1次调用开始看起。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608171823863.png" alt="image-20250608171823863"></p>
<p>第一次调用来自于0x92eec。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608183325917.png" alt="image-20250608183325917"></p>
<p>这里的sub_93390没有看到参数列表。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608183652512.png" alt="image-20250608183652512" style="zoom:67%;" />

<p>根据汇编，大概有3个参数，因此可以修改函数签名。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608183908545.png" alt="image-20250608183908545"></p>
<p>而且这里的v3，一看就是之前分析的那个结构，修改变量类型。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608184300820.png" alt="image-20250608184300820" style="zoom:80%;" />

<p>hook函数sub_93390，看看返回值和入参。——返回值可以通过入参a1的前16字节获得。</p>
<p>根据大量的0x36，可以判断这是一个hmac-md5算法。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608201229798.png" alt="image-20250608201229798" style="zoom:80%;" />

<p>整理一下，5次调用sub_93390的入参、返回值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">// 第1次调用</span><br><span class="line">// x0</span><br><span class="line">0000: 76 54 32 10 FE DC BA 98 89 AB CD EF 01 23 45 67    vT2..........#Eg</span><br><span class="line">// x1（key与0x36的结果）</span><br><span class="line">0000: 6A 3E 23 D6 BC E6 B7 B9 C6 D2 4B D7 6C 78 02 D9    j&gt;#.......K.lx..</span><br><span class="line">0010: 72 84 55 82 03 93 5F 6E 20 B3 32 87 75 82 F9 8D    r.U..._n .2.u...</span><br><span class="line">0020: 38 43 90 71 D4 5C B9 1A 8D 63 39 3D F7 94 59 C7    8C.q.\...c9=..Y.</span><br><span class="line">0030: 7C 27 5A FD 1D 68 77 A5 BE 4D 91 14 E5 8D 0E 51    |&#x27;Z..hw..M.....Q</span><br><span class="line">// x2</span><br><span class="line">0x1</span><br><span class="line">// 返回值</span><br><span class="line">0000: 39 0A 80 0F EC FE 50 43 EE 54 1F 5B 06 9C 47 8B    9.....PC.T.[..G.</span><br><span class="line"></span><br><span class="line">// 第2次调用</span><br><span class="line">// x0</span><br><span class="line">0000: 76 54 32 10 FE DC BA 98 89 AB CD EF 01 23 45 67    vT2..........#Eg</span><br><span class="line">// x1（key与0x5C的结果）</span><br><span class="line">0000: 00 54 49 BC D6 8C DD D3 AC B8 21 BD 06 12 68 B3    .TI.......!...h.</span><br><span class="line">0010: 18 EE 3F E8 69 F9 35 04 4A D9 58 ED 1F E8 93 E7    ..?.i.5.J.X.....</span><br><span class="line">0020: 52 29 FA 1B BE 36 D3 70 E7 09 53 57 9D FE 33 AD    R)...6.p..SW..3.</span><br><span class="line">0030: 16 4D 30 97 77 02 1D CF D4 27 FB 7E 8F E7 64 3B    .M0.w....&#x27;.~..d;</span><br><span class="line">// x2</span><br><span class="line">0x1</span><br><span class="line">// 返回值</span><br><span class="line">0000: 29 9A 8E 4B 77 48 EA 98 E3 E3 DF 8C C7 D2 4B 4A    )..KwH........KJ</span><br><span class="line"></span><br><span class="line">// 第3次调用</span><br><span class="line">// x0</span><br><span class="line">0000: 39 0A 80 0F EC FE 50 43 EE 54 1F 5B 06 9C 47 8B    9.....PC.T.[..G.</span><br><span class="line">// x1</span><br><span class="line">0000: 2F 61 70 69 2F 73 6E 73 2F 76 34 2F 75 73 65 72    /api/sns/v4/user</span><br><span class="line">0010: 2F 6C 6F 67 69 6E 2F 70 61 73 73 77 6F 72 64 66    /login/passwordf</span><br><span class="line">0020: 69 64 3D 31 37 34 34 32 39 38 31 30 38 31 30 31    id=1744298108101</span><br><span class="line">0030: 33 64 32 30 63 39 31 35 38 61 30 61 39 62 32 39    3d20c9158a0a9b29</span><br><span class="line">0040: 61 62 62 63 62 62 31 65 64 37 32 36 66 35 62 26    abbcbb1ed726f5b&amp;</span><br><span class="line">0050: 67 69 64 3D 37 63 30 64 36 38 65 38 36 34 37 61    gid=7c0d68e8647a</span><br><span class="line">0060: 35 34 33 38 61 32 33 39 34 62 62 61 64 33 36 34    5438a2394bbad364</span><br><span class="line">0070: 63 32 62 64 66 33 31 62 39 38 37 39 34 37 33 35    c2bdf31b98794735</span><br><span class="line">0080: 39 34 34 30 37 37 62 62 66 63 35 35 26 64 65 76    944077bbfc55&amp;dev</span><br><span class="line">0090: 69 63 65 5F 6D 6F 64 65 6C 3D 70 68 6F 6E 65 26    ice_model=phone&amp;</span><br><span class="line">00A0: 74 7A 3D 41 73 69 61 25 32 46 53 68 61 6E 67 68    tz=Asia%2FShangh</span><br><span class="line">00B0: 61 69 26 63 68 61 6E 6E 65 6C 3D 56 69 76 6F 26    ai&amp;channel=Vivo&amp;</span><br><span class="line">00C0: 76 65 72 73 69 6F 6E 4E 61 6D 65 3D 38 2E 37 37    versionName=8.77</span><br><span class="line">00D0: 2E 30 26 64 65 76 69 63 65 49 64 3D 31 30 66 39    .0&amp;deviceId=10f9</span><br><span class="line">00E0: 31 66 36 38 2D 37 64 62 37 2D 33 61 33 36 2D 38    1f68-7db7-3a36-8</span><br><span class="line">00F0: 30 63 39 2D 37 30 33 61 62 61 64 38 66 65 65 32    0c9-703abad8fee2</span><br><span class="line">0100: 26 70 6C 61 74 66 6F 72 6D 3D 61 6E 64 72 6F 69    &amp;platform=androi</span><br><span class="line">0110: 64 26 73 69 64 3D 73 65 73 73 69 6F 6E 2E 31 37    d&amp;sid=session.17</span><br><span class="line">0120: 34 34 33 30 30 36 32 36 36 35 35 37 30 31 36 32    4430062665570162</span><br><span class="line">0130: 39 31 35 30 26 69 64 65 6E 74 69 66 69 65 72 5F    9150&amp;identifier_</span><br><span class="line">0140: 66 6C 61 67 3D 34 26 70 72 6F 6A 65 63 74 5F 69    flag=4&amp;project_i</span><br><span class="line">0150: 64 3D 45 43 46 41 41 46 26 78 5F 74 72 61 63 65    d=ECFAAF&amp;x_trace</span><br><span class="line">0160: 5F 70 61 67 65 5F 63 75 72 72 65 6E 74 3D 6C 6F    _page_current=lo</span><br><span class="line">0170: 67 69 6E 5F 66 75 6C 6C 5F 73 63 72 65 65 6E 5F    gin_full_screen_</span><br><span class="line">0180: 70 77 64 5F 70 61 67 65 26 6C 61 6E 67 3D 7A 68    pwd_page&amp;lang=zh</span><br><span class="line">0190: 2D 48 61 6E 73 26 61 70 70 5F 69 64 3D 45 43 46    -Hans&amp;app_id=ECF</span><br><span class="line">01A0: 41 41 46 30 31 26 75 69 73 3D 6C 69 67 68 74 26    AAF01&amp;uis=light&amp;</span><br><span class="line">01B0: 74 65 65 6E 61 67 65 72 3D 30 26 61 63 74 69 76    teenager=0&amp;activ</span><br><span class="line">01C0: 65 5F 63 74 72 79 3D 43 4E 26 63 70 75 5F 6E 61    e_ctry=CN&amp;cpu_na</span><br><span class="line">01D0: 6D 65 3D 51 75 61 6C 63 6F 6D 6D 2B 54 65 63 68    me=Qualcomm+Tech</span><br><span class="line">01E0: 6E 6F 6C 6F 67 69 65 73 25 32 43 2B 49 6E 63 2B    nologies%2C+Inc+</span><br><span class="line">01F0: 53 4D 38 31 35 30 26 64 6C 61 6E 67 3D 7A 68 26    SM8150&amp;dlang=zh&amp;</span><br><span class="line">0200: 6C 61 75 6E 63 68 5F 69 64 3D 31 37 34 34 34 33    launch_id=174443</span><br><span class="line">0210: 36 33 39 32 26 6F 76 65 72 73 65 61 73 5F 63 68    6392&amp;overseas_ch</span><br><span class="line">0220: 61 6E 6E 65 6C 3D 30 26 6D 6C 61 6E 67 75 61 67    annel=0&amp;mlanguag</span><br><span class="line">0230: 65 3D 7A 68 5F 63 6E 26 66 6F 6C 64 65 72 5F 74    e=zh_cn&amp;folder_t</span><br><span class="line">0240: 79 70 65 3D 6E 6F 6E 65 26 61 75 74 6F 5F 74 72    ype=none&amp;auto_tr</span><br><span class="line">0250: 61 6E 73 3D 30 26 74 3D 31 37 34 34 34 33 36 33    ans=0&amp;t=17444363</span><br><span class="line">0260: 38 35 26 62 75 69 6C 64 3D 38 37 37 30 32 39 39    85&amp;build=8770299</span><br><span class="line">0270: 26 68 6F 6C 64 65 72 5F 63 74 72 79 3D 43 4E 26    &amp;holder_ctry=CN&amp;</span><br><span class="line">0280: 64 69 64 3D 32 64 33 35 31 62 62 65 66 31 64 62    did=2d351bbef1db</span><br><span class="line">0290: 38 33 38 63 35 66 63 64 36 62 36 37 61 34 61 61    838c5fcd6b67a4aa</span><br><span class="line">02A0: 31 64 62 35 38 38 70 6C 61 74 66 6F 72 6D 3D 61    1db588platform=a</span><br><span class="line">02B0: 6E 64 72 6F 69 64 26 62 75 69 6C 64 3D 38 37 37    ndroid&amp;build=877</span><br><span class="line">02C0: 30 32 39 39 26 64 65 76 69 63 65 49 64 3D 35 31    0299&amp;deviceId=51</span><br><span class="line">02D0: 38 64 66 65 39 36 2D 37 66 36 66 2D 33 37 30 61    8dfe96-7f6f-370a</span><br><span class="line">02E0: 2D 38 65 38 30 2D 66 39 34 66 38 38 33 38 65 36    -8e80-f94f8838e6</span><br><span class="line">02F0: 64 65 66 73 3D 30 26 70 6F 69 6E 74 3D 31 39 33    defs=0&amp;point=193</span><br><span class="line">0300: 32 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    2...............</span><br><span class="line">// x2</span><br><span class="line">0xc</span><br><span class="line">// 返回值</span><br><span class="line">0000: 81 97 7E 83 36 B7 43 2D 01 34 A6 A4 34 6C 32 06    ..~.6.C-.4..4l2.</span><br><span class="line"></span><br><span class="line">// 第4次调用</span><br><span class="line">// x0</span><br><span class="line">0000: 81 97 7E 83 36 B7 43 2D 01 34 A6 A4 34 6C 32 06    ..~.6.C-.4..4l2.</span><br><span class="line">// x1</span><br><span class="line">0000: 32 80 00 00 00 00 00 00 00 00 00 00 00 00 00 00    2...............</span><br><span class="line">0010: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................</span><br><span class="line">0020: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................</span><br><span class="line">0030: 00 00 00 00 00 00 00 00 08 1A 00 00 00 00 00 00    ................</span><br><span class="line">// x2</span><br><span class="line">0x1</span><br><span class="line">// 返回值</span><br><span class="line">0000: 8D 67 06 8C 91 18 85 7B FB 78 DB 01 59 F2 09 69    .g.....&#123;.x..Y..i</span><br><span class="line"></span><br><span class="line">// 第5次调用</span><br><span class="line">// x0</span><br><span class="line">0000: 29 9A 8E 4B 77 48 EA 98 E3 E3 DF 8C C7 D2 4B 4A    )..KwH........KJ</span><br><span class="line">// x1</span><br><span class="line">0000: 8D 67 06 8C 91 18 85 7B FB 78 DB 01 59 F2 09 69    .g.....&#123;.x..Y..i</span><br><span class="line">0010: 80 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................</span><br><span class="line">0020: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................</span><br><span class="line">0030: 00 00 00 00 00 00 00 00 80 02 00 00 00 00 00 00    ................</span><br><span class="line">// x2</span><br><span class="line">0x1</span><br><span class="line">// 返回值</span><br><span class="line">0000: 72 4B A0 52 97 97 13 0E 0B C3 00 2F BF C2 C7 5F    rK.R......./..._</span><br></pre></td></tr></table></figure>

<p>注意到，第5次调用sub_93390的返回值正是我们需要的16字节。</p>
<p>同时发现：</p>
<ol>
<li>第1次调用的返回值，是第3次加密的魔数值——0x36与key异或作为输入，魔数是标准md5魔数；</li>
<li>第2次调用的返回值，是第5次加密的魔数值——0x5C与key异或作为输入，魔数是标准md5魔数；</li>
<li>第3次调用的返回值，是第4次加密的魔数值——明文url + xy-common-params + xy-direction + platform + build + deviceId + xy-scene作为输入，魔数是第1次调用的返回值；</li>
<li>第4次调用的返回值，是第5次加密的输入——第4次调用的输入是第3次加密中，末尾不足64字节的部分；如果第3次调用刚好满足每组都是64字节，第4次调用的输入将是0x80开头，然后在最后的8个字节中，会描述前面的所有块的大小。</li>
<li>第5次加密就是将第4次的16字节进行了填充得到最终的16字节。</li>
</ol>
<p>单独看每次调用，其实每次调用都是魔改MD5算法，而将5次魔改MD5的调用合在一起，就是一个HMAC-MD5调用，整个流程应该这样子理解：</p>
<p>第1次调用魔改MD5，是对**（密钥 ^ 0x36）<strong>的结果进行的魔改MD5运算，这一次调用的目的是获得用作第3次调用的魔数（16字节），这16字节并非是用来作为</strong>K’**，再次说明：密钥是64字节，不需要经过MD5运算获得16字节，再填充至64字节，这里进行MD5仅仅是为了获得第3次调用的魔数，因为第3次调用是第1次调用的延续。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608213042711.png" alt="image-20250608213042711"></p>
<p>暂时不管第2次调用。</p>
<p>第3次调用魔改MD5，是对明文进行计算MD5的值，明文长度为0x301字节，魔数是第1次调用的结果（16字节）。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608213356686.png" alt="image-20250608213356686"></p>
<p>按照HMAC-MD5计算方式，K’是密钥，ipad是64个字节的0x36，两者异或后还是64字节，然后拼接上明文，再进行魔改的MD5运算，这时候，输入MD5运算的长度是0x301+0x40，即0x341字节。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608213042711.png" alt="image-20250608213042711"></p>
<p>而MD5运算，一次处理64字节，如果最后一组不满64字节，则填充448位，最后8字节用来表示这一次输入MD5运算的位数是多少。0x341个字节，即输入了0x1A08位数据。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608214219574.png" alt="image-20250608214219574" style="zoom:80%;" />

<p>第4次调用，单独处理1个字节，因为0x341个字节，可以分为13个64字节分组和单独1个字节，第4次调用就是处理这个字节的，注意下图，0x32后填充了一个0x80（即后面填充一个1和“无数”个0），而最后8字节是0x1A08，代表着处理的位数。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608214446344.png" alt="image-20250608214446344" style="zoom:67%;" />

<p>将第1、3、4次调用放在一块看，最后获得了<strong>HMAC-MD5</strong>这一步的结果。↓</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608213042711.png" alt="image-20250608213042711"></p>
<p>第2次调用是获得（K’ ^ 0x5C）的MD5运算后的结果（16字节），用来作为第5次调用的魔数（因为在附加连接的时候，是K’在前面，说白了，魔数代表着前面几次MD5运算的结果）。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608214939057.png" alt="image-20250608214939057" style="zoom:80%;" />

<p>第5次调用，是计算H(K’ ^ 0x5C || H(K’ ^ 0x36 || 明文)) ，输入是（K’ ^ 0x5C）|| （第1、3、4次调用的结果），已知（K’ ^ 0x5C）是64字节，而（第1、3、4次调用的结果）肯定是16字节，所以一共是80字节。</p>
<p>下图中0x80是填充，最后8字节是0x280，即80字节。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608215911675.png" alt="image-20250608215911675"></p>
<p>到这里，也能理解之前为什么调用了16次sub_93F14。因为第1-5次调用sub_93390，分别执行了1、1、12、1、1次魔改MD5运算。</p>
<p>之所以说这是魔改MD5，是因为在个别轮次的运算，不是标准MD5的FF、GG、HH、II。</p>
<p>点开sub_93390。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609103836334.png" alt="image-20250609103836334" style="zoom:80%;" />

<p>根据日志，对sub_93390调用链进行分析，MD5一共64轮运算，将每轮运算依次与标准MD5进行对比。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609112747484.png" alt="image-20250609112747484" style="zoom: 50%;" />

<p>在日志中，追踪BR跳转，sub_94970是第1个较为“完整”的函数。（这里的完整指的是：有些函数的伪代码在IDA的分析下，显示为直接BR跳转；而这个函数会先执行一些操作再跳转）</p>
<p>根据动调，发现前4行代码加载了魔数，第5行代码加载了待加密数据的地址，具体内容写在注释上了…函数sub_94970似乎在为MD5的第一轮运算做准备。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609135943423.png" alt="image-20250609135943423"></p>
<p>接下来，来到函数sub_95080，这应该是md5的<strong>第一轮加密</strong>。循环左移7位变成了6位。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609144742615.png" alt="image-20250609144742615"></p>
<p>hook了一下v7+132的位置应该是T盒，但并不是标准的T盒。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609150053963.png" alt="image-20250609150053963"></p>
<p>函数sub_95654，为明文的第2、3个字做准备。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609152424760.png" alt="image-20250609152424760"></p>
<p>函数sub_93DD8中，MD5<strong>第二轮加密</strong>。循环左移12位变成了循环左移13位。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609154735081.png" alt="image-20250609154735081"></p>
<p>具体的不在这里一一分析，做个总结。</p>
<h5 id="魔改左移操作数"><a href="#魔改左移操作数" class="headerlink" title="魔改左移操作数"></a>魔改左移操作数</h5><p>第43轮的左移操作数被改，在地址<code>0x93AC8</code>处，<strong>原操作数为 16，被改为 11</strong></p>
<p>第42轮的左移操作数被改，在地址<code>0x93A90</code>处，<strong>原操作数为11 ，被改为 16</strong></p>
<p>第41轮的左移操作数被改，在地址<code>0x93A78</code>处，<strong>原操作数为 4，被改为 23</strong></p>
<p>第40轮的左移操作数被改，在地址<code>0x94368</code>处，<strong>原操作数为 23，被改为 4</strong></p>
<p>第14轮的左移操作数被改，在地址<code>0x9480C</code>处，<strong>原操作数为 12，被改为 13</strong></p>
<p>第11轮的左移操作数被改，在地址<code>0x94E00</code>处，<strong>原操作数为 17，被改为 16</strong></p>
<p>第8轮的左移操作数被改，在地址<code>0x93888</code>处，<strong>原操作数为 22，被改为 20</strong></p>
<p>第4轮的左移操作数被改，在地址<code>0x952E4</code>处，<strong>原操作数为 22，被改为 21</strong></p>
<p>第2轮的左移操作数被改，在地址<code>0x93E28</code>处，<strong>原操作数为 12，被改为 13</strong></p>
<p>第1轮的左移操作数被改，在地址<code>0x950F0</code>处，所属函数<code>sub_95080</code>，<strong>原操作数为 7 ，被改为 6</strong></p>
<h5 id="魔改T值"><a href="#魔改T值" class="headerlink" title="魔改T值"></a>魔改T值</h5><p>标准MD5的T值是：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">int</span> t[] = &#123;</span><br><span class="line">      <span class="number">0xd76aa478</span>, <span class="number">0xe8c7b756</span>, <span class="number">0x242070db</span>, <span class="number">0xc1bdceee</span>, <span class="number">0xf57c0faf</span>, <span class="number">0x4787c62a</span>, <span class="number">0xa8304613</span>, <span class="number">0xfd469501</span>,</span><br><span class="line">      <span class="number">0x698098d8</span>, <span class="number">0x8b44f7af</span>, <span class="number">0xffff5bb1</span>, <span class="number">0x895cd7be</span>, <span class="number">0x6b901122</span>, <span class="number">0xfd987193</span>, <span class="number">0xa679438e</span>, <span class="number">0x49b40821</span>,</span><br><span class="line">      <span class="number">0xf61e2562</span>, <span class="number">0xc040b340</span>, <span class="number">0x265e5a51</span>, <span class="number">0xe9b6c7aa</span>, <span class="number">0xd62f105d</span>, <span class="number">0x02441453</span>, <span class="number">0xd8a1e681</span>, <span class="number">0xe7d3fbc8</span>,</span><br><span class="line">      <span class="number">0x21e1cde6</span>, <span class="number">0xc33707d6</span>, <span class="number">0xf4d50d87</span>, <span class="number">0x455a14ed</span>, <span class="number">0xa9e3e905</span>, <span class="number">0xfcefa3f8</span>, <span class="number">0x676f02d9</span>, <span class="number">0x8d2a4c8a</span>,</span><br><span class="line">      <span class="number">0xfffa3942</span>, <span class="number">0x8771f681</span>, <span class="number">0x6d9d6122</span>, <span class="number">0xfde5380c</span>, <span class="number">0xa4beea44</span>, <span class="number">0x4bdecfa9</span>, <span class="number">0xf6bb4b60</span>, <span class="number">0xbebfbc70</span>,</span><br><span class="line">      <span class="number">0x289b7ec6</span>, <span class="number">0xeaa127fa</span>, <span class="number">0xd4ef3085</span>, <span class="number">0x04881d05</span>, <span class="number">0xd9d4d039</span>, <span class="number">0xe6db99e5</span>, <span class="number">0x1fa27cf8</span>, <span class="number">0xc4ac5665</span>,</span><br><span class="line">      <span class="number">0xf4292244</span>, <span class="number">0x432aff97</span>, <span class="number">0xab9423a7</span>, <span class="number">0xfc93a039</span>, <span class="number">0x655b59c3</span>, <span class="number">0x8f0ccc92</span>, <span class="number">0xffeff47d</span>, <span class="number">0x85845dd1</span>,</span><br><span class="line">      <span class="number">0x6fa87e4f</span>, <span class="number">0xfe2ce6e0</span>, <span class="number">0xa3014314</span>, <span class="number">0x4e0811a1</span>, <span class="number">0xf7537e82</span>, <span class="number">0xbd3af235</span>, <span class="number">0x2ad7d2bb</span>, <span class="number">0xeb86d391</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>而魔改的T值是：</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0000</span>: <span class="type">56 B7 C9 E9 79 A4 1B D7 DB 81 10 24 D9 88 10 68    V</span>...y......$...h</span><br><span class="line"><span class="number">0010</span>: <span class="type">AF F7 14 9B B1 5B 1F FF BE D7 1C 88 22 61 66 66    </span>.....[......<span class="string">&quot;aff</span></span><br><span class="line"><span class="string">0020: 93 61 66 F6 9E 63 19 A6 21 09 14 49 EE CE 1D C1    .af..c..!..I....</span></span><br><span class="line"><span class="string">0030: AF 0F 1C F5 2A C6 17 47 13 46 10 A9 01 95 16 FD    ....*..G.F......</span></span><br><span class="line"><span class="string">0040: 00 25 00 F6 53 14 74 02 91 E6 21 D2 C9 11 00 E2    .%..S.t...!.....</span></span><br><span class="line"><span class="string">0050: E6 CD 61 22 97 0D D5 F2 ED 14 5A 42 05 E9 77 A2    ..a&quot;</span>......ZB..w.</span><br><span class="line"><span class="number">0060</span>: <span class="type">F9 A3 77 F2 D9 12 6F 62 9A 4C 2A 92 48 F2 39 12    </span>..w...ob.L*.H<span class="number">.9</span>.</span><br><span class="line"><span class="number">0070</span>: <span class="type">00 00 00 00 40 B3 40 C0 51 5A 5E 26 00 00 10 E9    </span>....<span class="meta">@.@.QZ^&amp;....</span></span><br><span class="line"><span class="number">0080</span>: <span class="type">5D 10 3F D6 D6 07 57 C3 42 39 FC FF 91 D6 7C 97    </span>].?...W.B9....|.</span><br><span class="line"><span class="number">0090</span>: <span class="type">44 EA BC A4 A9 CF DC 4B 70 BC BC BE C6 7E 8C 28    D</span>......Kp....~.(</span><br><span class="line"><span class="number">00</span>A0: <span class="type">60 4B CC F6 95 10 EC D4 FA 27 AC EA E5 88 DC E6    </span>`K.......<span class="string">&#x27;......</span></span><br><span class="line"><span class="string">00B0: 39 D0 DC D9 05 1D 8C 04 F9 7C A2 1F 90 F2 39 12    9........|....9.</span></span><br><span class="line"><span class="string">00C0: 00 00 00 00 22 61 9D 6D 65 56 AC C4 1C 39 E5 FD    ....&quot;a.meV...9..</span></span><br><span class="line"><span class="string">00D0: 44 22 29 F4 A7 23 94 AB 39 A0 93 F5 C3 59 5B 65    D&quot;)..#..9....Y[e</span></span><br><span class="line"><span class="string">00E0: 97 FF 2A 45 7D 24 EF F5 D1 5D 84 85 92 CC 0C 85    ..*E&#125;<span class="subst">$...]......</span></span></span><br><span class="line"><span class="subst"><span class="string">00F0: E0 26 99 F9 C0 F2 39 12 00 00 00 00 D6 A9 97 EF    .&amp;....9.........</span></span></span><br><span class="line"><span class="subst"><span class="string">0100: 4F 7E 99 F9 14 43 99 A9 82 7E 53 C5 A1 11 08 45    O~...C...~S....E</span></span></span><br><span class="line"><span class="subst"><span class="string">0110: A6 11 08 45 35 F2 3A BD 91 D3 86 EB</span></span></span><br></pre></td></tr></table></figure>

<p>为什么魔改后的T表比标准T表大呢？——多了7个4字节。</p>
<p>在函数sub_93BA4中，执行了第26、27、28轮运算，v0[59]是第27轮的t，v0[62]是第28轮的t，中间跳过了v0[60]、v0[61]，也就是2个4字节。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609155821938.png" alt="image-20250609155821938"></p>
<p>在函数sub_951A8中，执行了第45、46、47轮运算。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609160301578.png" alt="image-20250609160301578" style="zoom: 50%;" />

<p>而在函数sub_93A4C中，执行了第42、43、44轮运算，第45轮的t是v1[79]。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609160958764.png" alt="image-20250609160958764" style="zoom:80%;" />

<p>v1和v5基址一样，v1[79]到v5[82]，跳过了2个4字节，也就是8字节。</p>
<p>在函数sub_93CB4中，执行了第56、57、58轮运算，又跳过了3个4字节。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609160740608.png" alt="image-20250609160740608"></p>
<p>总共跳过了2 + 2 + 3个4字节，共计7个4字节，因此魔改后的T表多了7个4字节。</p>
<h5 id="入参顺序修改"><a href="#入参顺序修改" class="headerlink" title="入参顺序修改"></a>入参顺序修改</h5><p>假设HH的签名是HH（A，B，C，D，Mi，s，Ti）。</p>
<p>40轮：37轮结果对应为A位置，36轮结果对应B，38-39分别对应C-D，明文块取下标13</p>
<p>41轮：36轮结果对应为A位置，39轮结果对应B，38-40分别对应C-D，明文块取下标10</p>
<p>42轮：39轮结果对应为A位置，38轮结果对应B，40-41分别对应C-D，明文块取下标3</p>
<p>43轮：38轮结果对应为A位置，40轮结果对应B，41-42分别对应C-D，明文块取下标0</p>
<p>以第40轮的入参为例子。</p>
<p>标准MD5的情况下，原本第40轮的bcda分别来自于第36、39、38、37轮。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609163752074.png" alt="image-20250609163752074" style="zoom:67%;" />

<p>在函数sub_957D4中，v1-200存放着第36轮的结果b。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609164111974.png" alt="image-20250609164111974"></p>
<p>在函数sub_936C0中：</p>
<p>v2-196存放着第37轮的结果a。</p>
<p>v2-192存放着第38轮的结果d。</p>
<p>v2-188存放着第39轮的结果c。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609164347432.png" alt="image-20250609164347432"></p>
<p>正常的第40轮，应该是：HH(v-200, v-188, v-192, v-196，M10，23，tj)，展开后应该是这样子：</p>
<p>a &#x3D; (v-188) + (((v-200) + H(v-188, v-192, v-196) + M10 + tj) &lt;&lt;23)。</p>
<p>在函数sub_94344中是：HH(v-196, v-200, v-192, v-188, M13, 4, tj)。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609174510357.png" alt="image-20250609174510357"></p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609174519494.png" alt="image-20250609174519494"></p>
<p>同时发现，如果对第40轮取的明文进行打印，对应的M是第13块（下标），而非第10块，这里不过多赘述了。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609175346841.png" alt="image-20250609175346841"></p>
<h4 id="魔改AES，还原Q0"><a href="#魔改AES，还原Q0" class="headerlink" title="魔改AES，还原Q0"></a>魔改AES，还原Q0</h4><p>现在只剩下最后2个问题：</p>
<p><strong>一是</strong>之前Q0与Q1异或的结果是0x4，Q1是硬编码在文件中的，而Q0则涉及很多内容，对栈、堆下断点，一点一点追踪Q0的内容十分困难。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250604131821514.png" alt="image-20250604131821514"></p>
<p><strong>二是</strong>HMAC-MD5的密钥是哪里来的？</p>
<p>根据后来的结果，只要解决问题二，问题一就顺带解决了。</p>
<p>x1指向的内容，是密钥与0x36异或的结果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 第1次调用</span><br><span class="line">// x0</span><br><span class="line">0000: 76 54 32 10 FE DC BA 98 89 AB CD EF 01 23 45 67    vT2..........#Eg</span><br><span class="line">// x1（key与0x36的结果）</span><br><span class="line">0000: 6A 3E 23 D6 BC E6 B7 B9 C6 D2 4B D7 6C 78 02 D9    j&gt;#.......K.lx..</span><br><span class="line">0010: 72 84 55 82 03 93 5F 6E 20 B3 32 87 75 82 F9 8D    r.U..._n .2.u...</span><br><span class="line">0020: 38 43 90 71 D4 5C B9 1A 8D 63 39 3D F7 94 59 C7    8C.q.\...c9=..Y.</span><br><span class="line">0030: 7C 27 5A FD 1D 68 77 A5 BE 4D 91 14 E5 8D 0E 51    |&#x27;Z..hw..M.....Q</span><br><span class="line">// x2</span><br><span class="line">0x1</span><br><span class="line">// 返回值</span><br><span class="line">0000: 39 0A 80 0F EC FE 50 43 EE 54 1F 5B 06 9C 47 8B    9.....PC.T.[..G.</span><br></pre></td></tr></table></figure>

<p>再次异或0x36，获得key。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">5c 08 15 e0 8a d0 81 8f f0 e4 7d e1 5a 4e 34 ef </span><br><span class="line">44 b2 63 b4 35 a5 69 58 16 85 04 b1 43 b4 cf bb </span><br><span class="line">0e 75 a6 47 e2 6a 8f 2c bb 55 0f 0b c1 a2 6f f1 </span><br><span class="line">4a 11 6c cb 2b 5e 41 93 88 7b a7 22 d3 bb 38 67</span><br></pre></td></tr></table></figure>

<p>存放（密钥^0x36）的栈地址是0xe4fff320，在这里下一个写断点。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250608201229798.png" alt="image-20250608201229798" style="zoom:80%;" />

<p>偏移0x91708的位置。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609181802867.png" alt="image-20250609181802867"></p>
<p>说明密钥来自于[x25, #0x24]往后的64个字节。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609182441095.png" alt="image-20250609182441095"></p>
<p>地址是0x123e7024。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609182616292.png" alt="image-20250609182616292"></p>
<p>对0x123e7024下一个写断点。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609182703626.png" alt="image-20250609182703626" style="zoom:80%;" />

<p>偏移0x916d0。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609182802659.png" alt="image-20250609182802659"></p>
<p>在0x926B8下断点，获得X24的值。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609184353374.png" alt="image-20250609184353374"></p>
<p>再对0x123e2000下一个写断点。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609184832996.png" alt="image-20250609184832996"></p>
<p>这里的偏移是0x911c8，0x1c1f8是libc的偏移，所以这里看LR寄存器。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609185526029.png" alt="image-20250609185526029"></p>
<p>hook 0x911C4，获取源地址。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609185748505.png" alt="image-20250609185748505"></p>
<p>再在0xe4fff644下写断点，看看哪里往里写。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609185904231.png" alt="image-20250609185904231"></p>
<p>偏移0x9eddc。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609190228611.png" alt="image-20250609190228611"></p>
<p>在0x9edc4下断点，查看x24和x8.</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609190344879.png" alt="image-20250609190344879"></p>
<p>在0x123df100下写断点。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609190715406.png" alt="image-20250609190715406" style="zoom:80%;" />

<p>偏移0x91c84。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609191030509.png" alt="image-20250609191030509"></p>
<p>在0x91C80下断点，查看src。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609191128512.png" alt="image-20250609191128512"></p>
<p>在0x123dc070下个写断点。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609191218148.png" alt="image-20250609191218148"></p>
<p>偏移0x9aab8，之前分析第1-2字节的时候，遇到过这个偏移。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609191250304.png" alt="image-20250609191250304"></p>
<p>密钥来源于Q1、Q0的16字节异或的结果。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609191321658.png" alt="image-20250609191321658"></p>
<p>在0x9AAB4下断点，查看Q0、Q1的值。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609200150702.png" alt="image-20250609200150702" style="zoom: 67%;" />

<p>一共经历了6次地址0x9AAB4。</p>
<p>第1轮异或的结果是0x4，是我们之前想探究的2个字节的来源。</p>
<p>第2、3、4、5轮异或的结果合在一块，是密钥的64字节。</p>
<p>第6轮异或的结果像是<strong>PKCS7</strong>填充方式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">// 1</span><br><span class="line">q0=0x3966170766667a666108020434320135</span><br><span class="line">q1=0x3966170766667a666108020434320131</span><br><span class="line">// 结果</span><br><span class="line">q0=0x4</span><br><span class="line"></span><br><span class="line">// 2</span><br><span class="line">q0=0xbf8a86b75c5aa6988a18500d97aec16e</span><br><span class="line">q1=0x50bec8edbd2742680599808777bbc932</span><br><span class="line">// 结果</span><br><span class="line">q0=0xef344e5ae17de4f08f81d08ae015085c</span><br><span class="line"></span><br><span class="line">// 3</span><br><span class="line">q0=0x57ef40c30996ef5928798ead0a1f8562</span><br><span class="line">q1=0xec20f480b8926a4f70102b98be7c3726</span><br><span class="line">// 结果</span><br><span class="line">q0=0xbbcfb443b10485165869a535b463b244</span><br><span class="line"></span><br><span class="line">// 4</span><br><span class="line">q0=0x23cec11b0d7991d1bd27b2b6ecfdc56</span><br><span class="line">q1=0xf3534ed0bbd8cca6375d11c92969a958</span><br><span class="line">// 结果</span><br><span class="line">q0=0xf16fa2c10b0f55bb2c8f6ae247a6750e</span><br><span class="line"></span><br><span class="line">// 5</span><br><span class="line">q0=0xf78b842c37084a18aebc2f6959061f3f</span><br><span class="line">q1=0x90b33fff15af31903dfd7142926a0e75</span><br><span class="line">// 结果</span><br><span class="line">q0=0x6738bbd322a77b8893415e2bcb6c114a</span><br><span class="line"></span><br><span class="line">// 6</span><br><span class="line">q0=0x82a9df8040ac9909aee06a8949973ab0</span><br><span class="line">q1=0x92b9cf9050bc8919bef07a9959872aa0</span><br><span class="line">// 结果</span><br><span class="line">q0=0x10101010101010101010101010101010</span><br></pre></td></tr></table></figure>

<p>注意到，x19里面的地址，都是从x24里面取出来的。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609200122406.png" alt="image-20250609200122406"></p>
<p>x24指向的内容如下。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609200009519.png" alt="image-20250609200009519"></p>
<p>监控一下0x120b4000。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609201052310.png" alt="image-20250609201052310"></p>
<p>发现监控不到。。。</p>
<p>在IDA的伪代码中进行追踪。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609201701983.png" alt="image-20250609201701983"></p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609201718228.png" alt="image-20250609201718228"></p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609201736475.png" alt="image-20250609201736475"></p>
<p>打印一下result。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609201816219.png" alt="image-20250609201816219" style="zoom:67%;" />

<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609201833193.png" alt="image-20250609201833193" style="zoom:67%;" />

<p>后面发现，这里的x24源于hmac_main的值，hmac_main进行base64解码后的内容和它一模一样。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609200009519.png" alt="image-20250609200009519"></p>
<p>前面0x40字节在异或后是hmac-md5的密钥，而0x40-&gt;0x50字节抑或后是pkcs7填充的内容。</p>
<p>再对x22指向的0xe4fff148进行监控。（Q0）</p>
<p>之前追踪过0x9a064，找不到结果，这回追踪LR。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609205604237.png" alt="image-20250609205604237"></p>
<p>写的操作都发生在sub_994AC中，sub_994AC累积执行了6次。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609205746004.png" alt="image-20250609205746004"></p>
<p>偏移0x9a9cc位于函数sub_9A728，对这个函数分析，发现这个函数实现了一个<strong>对称分组密码</strong>的<strong>加密和解密</strong>操作，使用模式是CBC。</p>
<p>if(a6)分支实现了CBC加密模式。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609210746105.png" alt="image-20250609210746105" style="zoom:80%;" />

<p>if(a3)分支实现了CBC解密模式。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609210816395.png" alt="image-20250609210816395" style="zoom: 80%;" />

<p>根据分析，a5是IV，即初始化向量（盐），<strong>这是之前Q1的值</strong>。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609211022402.png" alt="image-20250609211022402"></p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609211109670.png" alt="image-20250609211109670" style="zoom: 80%;" />

<p>hook函数sub_994AC，查看它的入参。</p>
<p>注意到，第1次执行，对“32 C9 BB 77 87 80 99 05 68 42 27 BD ED C8 BE 50”解密，获得了“35 01 32 34 04 02 08 61 66 7A 66 66 07 17 66 39”，而“35 01 32 34 04 02 08 61 66 7A 66 66 07 17 66 39”正是0x9AAB4第一轮异或的Q0！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">第1次执行</span><br><span class="line">X0</span><br><span class="line">32 C9 BB 77 87 80 99 05 68 42 27 BD ED C8 BE 50</span><br><span class="line">X1</span><br><span class="line">58 97 27 12 0A 00 00 00 00 00 00 00 00 00 00 00</span><br><span class="line">返回值（第2次执行时的X1）</span><br><span class="line">35 01 32 34 04 02 08 61 66 7A 66 66 07 17 66 39</span><br><span class="line"></span><br><span class="line">第2次执行</span><br><span class="line">X0</span><br><span class="line">26 37 7C BE 98 2B 10 70 4F 6A 92 B8 80 F4 20 EC</span><br><span class="line">X1</span><br><span class="line">35 01 32 34 04 02 08 61 66 7A 66 66 07 17 66 39</span><br><span class="line">返回值（第3次执行时的X1）</span><br><span class="line">6E C1 AE 97 0D 50 18 8A 98 A6 5A 5C B7 86 8A BF</span><br><span class="line"></span><br><span class="line">第3次执行</span><br><span class="line">X0</span><br><span class="line">58 A9 69 29 C9 11 5D 37 A6 CC D8 BB D0 4E 53 F3</span><br><span class="line">X1</span><br><span class="line">6E C1 AE 97 0D 50 18 8A 98 A6 5A 5C B7 86 8A BF</span><br><span class="line">返回值（第4次执行时的X1）</span><br><span class="line">62 85 1F 0A AD 8E 79 28 59 EF 96 09 C3 40 EF 57</span><br><span class="line"></span><br><span class="line">第4次执行</span><br><span class="line">X0</span><br><span class="line">75 0E 6A 92 42 71 FD 3D 90 31 AF 15 FF 3F B3 90</span><br><span class="line">X1</span><br><span class="line">62 85 1F 0A AD 8E 79 28 59 EF 96 09 C3 40 EF 57</span><br><span class="line">返回值（第5次执行时的X1）</span><br><span class="line"></span><br><span class="line">第5次执行</span><br><span class="line">X0</span><br><span class="line">A0 2A 87 59 99 7A F0 BE 19 89 BC 50 90 CF B9 92</span><br><span class="line">X1</span><br><span class="line">56 DC CF 6E 2B 7B D2 1B 1D 99 D7 B0 11 EC 3C 02</span><br><span class="line">返回值（第6次执行时的X1）</span><br><span class="line">3F 1F 06 59 69 2F BC AE 18 4A 08 37 2C 84 8B F7</span><br><span class="line"></span><br><span class="line">第6次执行</span><br><span class="line">X0</span><br><span class="line">9B 48 8F D1 39 69 CA C2 54 E2 0A F2 0C 1C 4C 98</span><br><span class="line">X1</span><br><span class="line">3F 1F 06 59 69 2F BC AE 18 4A 08 37 2C 84 8B F7</span><br><span class="line">返回值</span><br><span class="line">b0 3a 97 49 89 6a3 e0 ae 09 99 ac 40 80 df a9 82</span><br></pre></td></tr></table></figure>

<p>sub_9A728采用了CBC模式，而函数sub_994AC每次处理又是16字节，这大概率是一个AES加解密。sub_994AC的第一个参数的待解密的16字节，第二个参数存放结果，第三个参数是轮密钥。</p>
<p>s.xml文件里存放的是密文。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250609200009519.png" alt="image-20250609200009519"></p>
<p>第1个16字节作为密文0，在AES解密后生成<strong>中间值[0]</strong>，中间值[0]就是35 01 32 34 04 02 08 61 66 7A 66 66 07 17 66 39，中间值[0]再与盐IV “31 01 32 34 04 02 08 61 66 7A 66 66 07 17 66 39”进行异或，生成明文[0]——0x4。</p>
<p>所以说，这里的明文0x4是固定的。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610101307202.png" alt="image-20250610101307202"></p>
<p>第2个16字节作为密文1，在AES解密后生成中间值[1]，中间值1就是6E C1 AE 97 0D 50 18 8A 98 A6 5A 5C B7 86 8A BF，中间值[1]再与密文0（32 C9 BB 77 87 80 99 05 68 42 27 BD ED C8 BE 50）进行异或，生成明文[1]——0xef344e5ae17de4f08f81d08ae015085c。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610101528397.png" alt="image-20250610101528397"></p>
<p>…以此类推，最后获得的内容是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 明文[0]，固定字节</span><br><span class="line">q0=0x4</span><br><span class="line"></span><br><span class="line">// 明文[1-4]，用作HMAC-MD5的密钥</span><br><span class="line">q0=0xef344e5ae17de4f08f81d08ae015085c</span><br><span class="line">q0=0xbbcfb443b10485165869a535b463b244</span><br><span class="line">q0=0xf16fa2c10b0f55bb2c8f6ae247a6750e</span><br><span class="line">q0=0x6738bbd322a77b8893415e2bcb6c114a</span><br><span class="line"></span><br><span class="line">// PKCS7填充</span><br><span class="line">q0=0x10101010101010101010101010101010</span><br></pre></td></tr></table></figure>

<p>也就是说，xhs服务器那边发来的xml文件，其实藏了0x4和MD5的密钥。</p>
<p>接下来还有2个疑惑AES是否魔改？密钥是什么？</p>
<p>为了解答疑惑，需要追踪函数sub_994AC，这个函数专门负责AES解密，难点在于，这个函数与魔改MD5一样，频繁通过BR跳转到别的函数，代码片段零零散散。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610104537106.png" alt="image-20250610104537106"></p>
<p>根据分析，每一次执行sub_994AC，最终都会调用下面这些函数。</p>
<p>0-3次循环都一样，第4次循环出现变化；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">994AC</span><br><span class="line">9a260				// 0-3字节：轮密钥加</span><br><span class="line">99e6c				// 4-7字节：轮密钥加</span><br><span class="line">9a40c				// 8-11字节：轮密钥加</span><br><span class="line">9a574				// 12-15字节：轮密钥加</span><br><span class="line">995e8</span><br><span class="line">99c40&lt;----循环0</span><br><span class="line">996d8				// 查表优化</span><br><span class="line">9a620				// 查表优化</span><br><span class="line">99a7c</span><br><span class="line">99564</span><br><span class="line">9a6ac</span><br><span class="line">9a2cc</span><br><span class="line">9991c&lt;&gt;</span><br><span class="line">9a0a0</span><br><span class="line">9a364</span><br><span class="line">99898</span><br><span class="line">9978c</span><br><span class="line">9a160</span><br><span class="line">99ee0</span><br><span class="line">99f74</span><br><span class="line">9969c</span><br><span class="line">99c40&lt;----循环1</span><br><span class="line">996d8</span><br><span class="line">9a620</span><br><span class="line">99a7c</span><br><span class="line">99564</span><br><span class="line">9a6ac</span><br><span class="line">9a2cc</span><br><span class="line">9991c&lt;&gt;</span><br><span class="line">9a0a0</span><br><span class="line">9a364</span><br><span class="line">99898</span><br><span class="line">9978c</span><br><span class="line">9a160</span><br><span class="line">99ee0</span><br><span class="line">99f74</span><br><span class="line">9969c</span><br><span class="line">99c40&lt;----循环2</span><br><span class="line">996d8</span><br><span class="line">9a620</span><br><span class="line">99a7c</span><br><span class="line">99564</span><br><span class="line">9a6ac</span><br><span class="line">9a2cc</span><br><span class="line">9991c&lt;&gt;</span><br><span class="line">9a0a0</span><br><span class="line">9a364</span><br><span class="line">99898</span><br><span class="line">9978c</span><br><span class="line">9a160</span><br><span class="line">99ee0</span><br><span class="line">99f74</span><br><span class="line">9969c</span><br><span class="line">99c40&lt;----循环3</span><br><span class="line">996d8</span><br><span class="line">9a620</span><br><span class="line">99a7c</span><br><span class="line">99564</span><br><span class="line">9a6ac</span><br><span class="line">9a2cc</span><br><span class="line">9991c&lt;&gt;</span><br><span class="line">9a0a0</span><br><span class="line">9a364</span><br><span class="line">99898</span><br><span class="line">9978c</span><br><span class="line">9a160</span><br><span class="line">99ee0</span><br><span class="line">99f74</span><br><span class="line">9969c</span><br><span class="line">99c40&lt;----循环4</span><br><span class="line">996d8</span><br><span class="line">9a620</span><br><span class="line">99a7c</span><br><span class="line">99564</span><br><span class="line">9a6ac</span><br><span class="line">9a2cc</span><br><span class="line">9991c&lt;&gt;</span><br><span class="line">9a4a0&lt;差异点&gt;</span><br><span class="line">9984c</span><br><span class="line">9a00c</span><br></pre></td></tr></table></figure>

<p>同时，之前提到的0x9a064位于函数sub_9A00C内部，0x9a064会在每次循环中，会修改下图的X22寄存器指向的地址，这间接改变了Q0的内容，而Q0指向解密后的中间值（之所以称作中间值，是因为CBC模式下，中间值还要和上一轮密文进行异或，才能得到最后的明文），这说明了执行到sub_9A00C的时候，已经完成了AES解密。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250605222117031.png" alt="image-20250605222117031"></p>
<p>开始分析上述函数——从sub_9A260开始。</p>
<p>hook函数sub_994AC的时候，第3个参数是轮密钥。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610150634104.png" alt="image-20250610150634104" style="zoom:80%;" />

<p>hook函数sub_9A260，发现下面的情况。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610151800401.png" alt="image-20250610151800401"></p>
<p>这说明sub_9A260在对密文进行“轮密钥加”。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610151117804.png" alt="image-20250610151117804"></p>
<h5 id="初始密钥"><a href="#初始密钥" class="headerlink" title="初始密钥"></a>初始密钥</h5><p>加密与解密的流程是反过来的，既然a3是轮密钥，可以倒推回初始密钥。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610180411680.png" alt="image-20250610180411680"></p>
<p>在0xE4FFF398下一个写断点，观察到偏移0x981b4。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610181026760.png" alt="image-20250610181026760"></p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610181924741.png" alt="image-20250610181924741"></p>
<p>在偏移0x981A0处下一个断点，观察x2+x8。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610182010991.png" alt="image-20250610182010991"></p>
<p>往0xe4fff2f8下一个写断点。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610182136699.png" alt="image-20250610182136699"></p>
<p>偏移0x96a44，位于函数sub_96A14中。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610182337520.png" alt="image-20250610182337520"></p>
<p>hook一下函数sub_96A14，打印a1，a1是device_id的前16字节。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610182455586.png" alt="image-20250610182455586"></p>
<p>因此，aes密钥的种子是device_id。</p>
<h5 id="解密——Td表（未改动）"><a href="#解密——Td表（未改动）" class="headerlink" title="解密——Td表（未改动）"></a>解密——Td表（未改动）</h5><p>稍微分析了一下，AES解密采取的方式是查T表，查表的话AES的解密速率会快很多，但没有一般的特征了（行位移、字节替换等），所以不好分析。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610161717758.png" alt="image-20250610161717758" style="zoom: 67%;" />

<p>来到函数sub_996d8，0x6a5fcc9b是标准Td[0]表的4个字节，打印一下T表。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610162437314.png" alt="image-20250610162437314"></p>
<p>和标准的Td[0]表一模一样。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610164121960.png" alt="image-20250610164121960" style="zoom:80%;" />

<p>另外3个表会基于Td[0]进行生成，简单来说就是对基础表中的每一个32位数值执行<strong>字节的循环右移</strong>，因此可以根据Td[0]生成另外3个T表。经过对比，4个T表都是标准的。</p>
<h5 id="密钥扩展"><a href="#密钥扩展" class="headerlink" title="密钥扩展"></a>密钥扩展</h5><p>这里，我们为了追踪密钥扩展的函数，可以追踪初始密钥。</p>
<p>追踪sub_96A14的执行流，寻找对device_id进行处理加密，最终获得初始密钥的位置。</p>
<p>根据分析，在函数sub_96A14、sub_95A3C、sub_97100、sub_960F8中，完成了对初始密钥的构建。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610194708525.png" alt="image-20250610194708525"></p>
<p>已知，初始密钥是W[3:0]，是根据device_id异或4个固定的4字节生成的；（0-3轮密钥）</p>
<p>而接下来的第4-39轮密钥是根据查表的方式生成的。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610200719014.png" alt="image-20250610200719014"></p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610200923629.png" alt="image-20250610200923629" style="zoom:80%;" />

<p>在日志中，发现了一个规律——最左边框框里面的轮密钥，统一由函数sub_980ac查表获得；左2的框框统一由函数sub_97490查表获得，左3的框框统一由函数sub_97980获得、左4的框框统一由sub_973a8查表获得。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610204851290.png" alt="image-20250610204851290"></p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610204754405.png" alt="image-20250610204754405"></p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610204723149.png" alt="image-20250610204723149"></p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610204634679.png" alt="image-20250610204634679"></p>
<p>这4个函数都只执行9次，生成了W[39:4]，此时，还未知W[43:40]的生成方式，但应该是正常的标准扩展方式。</p>
<p>正常的密钥扩展如下图所示。</p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610185453688.png" alt="image-20250610185453688" style="zoom: 50%;" />

<p>我们在日志中搜索W[43:40]的轮密钥——比如：搜索0x1070c115，然后来到第1次出现的地方。注意到，eor的w9和w12中并没有出现0xf0106B39，如果是标准的扩展算法，应该会出现0xf0106B39的。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610211445431.png" alt="image-20250610211445431"></p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610214036112.png" alt="image-20250610214036112"></p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610214119895.png" alt="image-20250610214119895"></p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610214218532.png" alt="image-20250610214218532"></p>
<p>可以看到，T函数明显被修改了，除此之外，W[43:40]的结果本来是两个轮密钥异或的结果，但在上图中，由一个轮密钥和一个未知的4字节异或得到的。</p>
<p>密钥扩展中最后4轮密钥是如何生成的？涉及到查S盒、字节替换、Rcon等——需要交叉引用96b08、96d5c。</p>
<p>这里简单过一下，具体算法还原先不做，快秋招了，得做点其它的事情，补充一下开发能力QwQ，害，怎么感觉这么难呢，我好菜。</p>
<p>以W[40]为例，W[40] &#x3D; <code>*(_DWORD *)(a1 + 60) = *(_DWORD *)(a1 + 52) ^ *(_DWORD *)(a1 + 56);</code></p>
<img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610221100210.png" alt="image-20250610221100210" style="zoom:80%;" />

<p>需要hook一下，获得a1+52、a1+44、a1+48等值。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610221500239.png" alt="image-20250610221500239"></p>
<p>它们的值又来源于sub_97230。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610221602792.png" alt="image-20250610221602792"></p>
<p>然后又来源于sub_97100。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610221712663.png" alt="image-20250610221712663"></p>
<p>又可以追回到sub_96A14。</p>
<p><img src="https://raw.githubusercontent.com/X14Nuy/Picture-Bed/master/img/image-20250610221857418.png" alt="image-20250610221857418"></p>
<p>大概意思是，W[43-40]与初始密钥相关，涉及S盒、字节交换、rcon。</p>
<p>具体关于逆T表的工作，等到以后吧，算法还原耗时但一定能解开，hhhhh。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>2025&#x2F;0610&#x2F;22:23，脑子有点晕，希望能早点找到工作。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>jidong大佬的公众号。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%BF%83%E7%B4%AF/" rel="tag"># 心累</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/05/29/%E6%89%B9%E9%87%8F%E4%B8%8A%E4%BC%A0typora%E5%9B%BE%E7%89%87%E5%88%B0%E5%9B%BE%E5%BA%8A%E7%9A%84%E8%84%9A%E6%9C%AC/" rel="prev" title="批量上传typora图片到图床的脚本">
                  <i class="fa fa-angle-left"></i> 批量上传typora图片到图床的脚本
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/06/12/%E6%9F%90%E6%A2%86%E4%BC%81%E4%B8%9A%E5%A3%B3-%E8%BF%87frida%E6%A3%80%E6%B5%8B/" rel="next" title="某梆企业壳--过frida检测">
                  某梆企业壳--过frida检测 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">X14Nuy</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">507k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">15:22</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
